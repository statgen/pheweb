!function(){var t=function(t,e){if(e==t)return!0;var i=t.split("."),a=e.split("."),n=!1;return i.forEach(function(t,e){!n&&+a[e]>+i[e]&&(n=!0)}),n};try{var e="3.5.6";if("object"!=typeof d3)throw"LocusZoom unable to load: d3 dependency not met. Library missing.";if(!t(e,d3.version))throw"LocusZoom unable to load: d3 dependency not met. Outdated version detected.\nRequired d3 version: "+e+" or higher (found: "+d3.version+").";if("function"!=typeof Q)throw"LocusZoom unable to load: Q dependency not met. Library missing.";var i={version:"0.4.8"};i.populate=function(t,e,a,n){if("undefined"==typeof t)throw"LocusZoom.populate selector not defined";if(d3.select(t).html(""),"undefined"!=typeof n){console.warn("Warning: state passed to LocusZoom.populate as fourth argument. This behavior is deprecated. Please include state as a parameter of layout");var s={state:n},o=a||{};a=i.Layouts.merge(s,o)}var r;return d3.select(t).call(function(){if("undefined"==typeof this.node().id){for(var t=0;!d3.select("#lz-"+t).empty();)t++;this.attr("id","#lz-"+t)}if(r=new i.Plot(this.node().id,e,a),"undefined"!=typeof this.node().dataset&&"undefined"!=typeof this.node().dataset.region){var n=i.parsePositionQuery(this.node().dataset.region);Object.keys(n).forEach(function(t){r.state[t]=n[t]})}r.svg=d3.select("div#"+r.id).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("id",r.id+"_svg").attr("class","lz-locuszoom"),r.setDimensions(),r.positionPanels(),r.initialize(),"object"==typeof e&&Object.keys(e).length&&r.refresh()}),r},i.populateAll=function(t,e,a,n){var s=[];return d3.selectAll(t).each(function(t,o){s[o]=i.populate(this,e,a,n)}),s},i.positionIntToString=function(t,e,i){var a={0:"",3:"K",6:"M",9:"G"};if(i=i||!1,isNaN(e)||null==e){var n=Math.log(t)/Math.LN10;e=Math.min(Math.max(n-n%3,0),9)}var s=e-Math.floor((Math.log(t)/Math.LN10).toFixed(e+3)),o=Math.min(Math.max(e,0),2),r=Math.min(Math.max(s,o),12),l=""+(t/Math.pow(10,e)).toFixed(r);return i&&"undefined"!=typeof a[e]&&(l+=" "+a[e]+"b"),l},i.positionStringToInt=function(t){var e=t.toUpperCase();e=e.replace(/,/g,"");var i=/([KMG])[B]*$/,a=i.exec(e),n=1;return a&&(n="M"==a[1]?1e6:"G"==a[1]?1e9:1e3,e=e.replace(i,"")),e=Number(e)*n},i.parsePositionQuery=function(t){var e=/^(\w+):([\d,.]+[kmgbKMGB]*)([-+])([\d,.]+[kmgbKMGB]*)$/,a=/^(\w+):([\d,.]+[kmgbKMGB]*)$/,n=e.exec(t);if(n){if("+"==n[3]){var s=i.positionStringToInt(n[2]),o=i.positionStringToInt(n[4]);return{chr:n[1],start:s-o,end:s+o}}return{chr:n[1],start:i.positionStringToInt(n[2]),end:i.positionStringToInt(n[4])}}return n=a.exec(t),n?{chr:n[1],position:i.positionStringToInt(n[2])}:null},i.prettyTicks=function(t,e,i){("undefined"==typeof i||isNaN(parseInt(i)))&&(i=5),i=parseInt(i);var a=i/3,n=.75,s=1.5,o=.5+1.5*s,r=Math.abs(t[0]-t[1]),l=r/i;Math.log(r)/Math.LN10<-2&&(l=Math.max(Math.abs(r))*n/a);var h=Math.pow(10,Math.floor(Math.log(l)/Math.LN10)),d=0;h<1&&0!=h&&(d=Math.abs(Math.round(Math.log(h)/Math.LN10)));var u=h;2*h-l<s*(l-u)&&(u=2*h,5*h-l<o*(l-u)&&(u=5*h,10*h-l<s*(l-u)&&(u=10*h)));for(var p=[],c=parseFloat((Math.floor(t[0]/u)*u).toFixed(d));c<t[1];)p.push(c),c+=u,d>0&&(c=parseFloat(c.toFixed(d)));return p.push(c),"undefined"!=typeof e&&["low","high","both","neither"].indexOf(e)!=-1||(e="neither"),"low"!=e&&"both"!=e||p[0]<t[0]&&(p=p.slice(1)),"high"!=e&&"both"!=e||p[p.length-1]>t[1]&&p.pop(),p},i.createCORSPromise=function(t,e,i,a,n){var s=Q.defer(),o=new XMLHttpRequest;if("withCredentials"in o?o.open(t,e,!0):"undefined"!=typeof XDomainRequest?(o=new XDomainRequest,o.open(t,e)):o=null,o){if(o.onreadystatechange=function(){4===o.readyState&&(200===o.status||0===o.status?s.resolve(o.response):s.reject("HTTP "+o.status+" for "+e))},n&&setTimeout(s.reject,n),i="undefined"!=typeof i?i:"","undefined"!=typeof a)for(var r in a)o.setRequestHeader(r,a[r]);o.send(i)}return s.promise},i.validateState=function(t,e){t=t||{},e=e||{};var i=!1;if("undefined"!=typeof t.chr&&"undefined"!=typeof t.start&&"undefined"!=typeof t.end){var a,n=null;if(t.start=Math.max(parseInt(t.start),1),t.end=Math.max(parseInt(t.end),1),isNaN(t.start)&&isNaN(t.end))t.start=1,t.end=1,n=.5,a=0;else if(isNaN(t.start)||isNaN(t.end))n=t.start||t.end,a=0,t.start=isNaN(t.start)?t.end:t.start,t.end=isNaN(t.end)?t.start:t.end;else{if(n=Math.round((t.start+t.end)/2),a=t.end-t.start,a<0){var s=t.start;t.end=t.start,t.start=s,a=t.end-t.start}n<0&&(t.start=1,t.end=1,a=0)}i=!0}return!isNaN(e.min_region_scale)&&i&&a<e.min_region_scale&&(t.start=Math.max(n-Math.floor(e.min_region_scale/2),1),t.end=t.start+e.min_region_scale),!isNaN(e.max_region_scale)&&i&&a>e.max_region_scale&&(t.start=Math.max(n-Math.floor(e.max_region_scale/2),1),t.end=t.start+e.max_region_scale),t},i.parseFields=function(t,e){if("object"!=typeof t)throw"LocusZoom.parseFields invalid arguments: data is not an object";if("string"!=typeof e)throw"LocusZoom.parseFields invalid arguments: html is not a string";var i,a;for(var n in t)t.hasOwnProperty(n)&&("string"!=typeof t[n]&&"number"!=typeof t[n]&&"boolean"!=typeof t[n]&&null!=t[n]||(i=new RegExp("\\{\\{"+n.replace("|","\\|").replace(":","\\:")+"\\}\\}","g"),a=null==t[n]?"":t[n],e=e.replace(i,a)));return e},i.getToolTipData=function(t){if("object"!=typeof t||"undefined"==typeof t.parentNode)throw"Invalid node object";var e=d3.select(t);return e.classed("lz-data_layer-tooltip")&&"undefined"!=typeof e.data()[0]?e.data()[0]:i.getToolTipData(t.parentNode)},i.getToolTipDataLayer=function(t){var e=i.getToolTipData(t);return e.getDataLayer?e.getDataLayer():null},i.getToolTipPanel=function(t){var e=i.getToolTipDataLayer(t);return e?e.parent:null},i.getToolTipPlot=function(t){var e=i.getToolTipPanel(t);return e?e.parent:null},i.Layouts=function(){var t={},e={plot:{},panel:{},data_layer:{},dashboard:{}};return t.get=function(t,a,n){if("string"!=typeof t||"string"!=typeof a)throw"invalid arguments passed to LocusZoom.Layouts.get, requires string (layout type) and string (layout name)";if(e[t][a]){var s=i.Layouts.merge(n||{},e[t][a]);if(s.unnamespaced)return delete s.unnamespaced,JSON.parse(JSON.stringify(s));var o="";"string"==typeof s.namespace?o=s.namespace:"object"==typeof s.namespace&&Object.keys(s.namespace).length&&(o="undefined"!=typeof s.namespace["default"]?s.namespace["default"]:s.namespace[Object.keys(s.namespace)[0]].toString()),o+=o.length?":":"";var r=function(t,e){if(e?"string"==typeof e&&(e={"default":e}):e={"default":""},"string"==typeof t){for(var a,n,s,l,h=/\{\{namespace(\[[A-Za-z_0-9]+\]|)\}\}/g,d=[];null!==(a=h.exec(t));)n=a[0],s=a[1].length?a[1].replace(/(\[|\])/g,""):null,l=o,null!=e&&"object"==typeof e&&"undefined"!=typeof e[s]&&(l=e[s]+(e[s].length?":":"")),d.push({base:n,namespace:l});for(var u in d)t=t.replace(d[u].base,d[u].namespace)}else if("object"==typeof t&&null!=t){if("undefined"!=typeof t.namespace){var p="string"==typeof t.namespace?{"default":t.namespace}:t.namespace;e=i.Layouts.merge(e,p)}var c,y;for(var g in t)"namespace"!=g&&(c=r(t[g],e),y=r(g,e),g!=y&&delete t[g],t[y]=c)}return t};return s=r(s,s.namespace),JSON.parse(JSON.stringify(s))}throw"layout type ["+t+"] name ["+a+"] not found"},t.set=function(t,i,a){if("string"!=typeof t||"string"!=typeof i||"object"!=typeof a)throw"unable to set new layout; bad arguments passed to set()";e[t]||(e[t]={}),a?e[t][i]=JSON.parse(JSON.stringify(a)):delete e[t][i]},t.add=function(e,i,a){t.set(e,i,a)},t.list=function(t){if(e[t])return Object.keys(e[t]);var i={};return Object.keys(e).forEach(function(t){i[t]=Object.keys(e[t])}),i},t.merge=function(t,e){if("object"!=typeof t||"object"!=typeof e)throw"LocusZoom.Layouts.merge only accepts two layout objects; "+typeof t+", "+typeof e+" given";for(var a in e)if(e.hasOwnProperty(a)){var n=null==t[a]?"undefined":typeof t[a],s=typeof e[a];if("object"==n&&Array.isArray(t[a])&&(n="array"),"object"==s&&Array.isArray(e[a])&&(s="array"),"function"==n||"function"==s)throw"LocusZoom.Layouts.merge encountered an unsupported property type";"undefined"!=n?"object"!=n||"object"!=s||(t[a]=i.Layouts.merge(t[a],e[a])):t[a]=JSON.parse(JSON.stringify(e[a]))}return t},t}(),i.Layouts.add("data_layer","signifigance",{namespace:{sig:"sig"},id:"significance",type:"line",fields:["{{namespace[sig]}}x","{{namespace[sig]}}y"],z_index:0,style:{stroke:"#D3D3D3","stroke-width":"3px","stroke-dasharray":"10px 10px"},x_axis:{field:"{{namespace[sig]}}x",decoupled:!0},y_axis:{axis:1,field:"{{namespace[sig]}}y"}}),i.Layouts.add("data_layer","recomb_rate",{namespace:{recomb:"recomb"},id:"recombrate",type:"line",fields:["{{namespace[recomb]}}position","{{namespace[recomb]}}recomb_rate"],z_index:1,style:{stroke:"#0000FF","stroke-width":"1.5px"},x_axis:{field:"{{namespace[recomb]}}position"},y_axis:{axis:2,field:"{{namespace[recomb]}}recomb_rate",floor:0,ceiling:100},transition:{duration:200}}),i.Layouts.add("data_layer","association_pvalues",{namespace:{"default":"",ld:"ld"},id:"associationpvalues",type:"scatter",point_shape:{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:"diamond","else":"circle"}},point_size:{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:80,"else":40}},color:[{scale_function:"if",field:"{{namespace[ld]}}isrefvar",parameters:{field_value:1,then:"#9632b8"}},{scale_function:"numerical_bin",field:"{{namespace[ld]}}state",parameters:{breaks:[0,.2,.4,.6,.8],values:["#357ebd","#46b8da","#5cb85c","#eea236","#d43f3a"]}},"#B8B8B8"],legend:[{shape:"diamond",color:"#9632b8",size:40,label:"LD Ref Var","class":"lz-data_layer-scatter"},{shape:"circle",color:"#d43f3a",size:40,label:"1.0 > r² ≥ 0.8","class":"lz-data_layer-scatter"},{shape:"circle",color:"#eea236",size:40,label:"0.8 > r² ≥ 0.6","class":"lz-data_layer-scatter"},{shape:"circle",color:"#5cb85c",size:40,label:"0.6 > r² ≥ 0.4","class":"lz-data_layer-scatter"},{shape:"circle",color:"#46b8da",size:40,label:"0.4 > r² ≥ 0.2","class":"lz-data_layer-scatter"},{shape:"circle",color:"#357ebd",size:40,label:"0.2 > r² ≥ 0.0","class":"lz-data_layer-scatter"},{shape:"circle",color:"#B8B8B8",size:40,label:"no r² data","class":"lz-data_layer-scatter"}],fields:["{{namespace}}variant","{{namespace}}position","{{namespace}}pvalue","{{namespace}}pvalue|scinotation","{{namespace}}pvalue|neglog10","{{namespace}}log_pvalue","{{namespace}}log_pvalue|logtoscinotation","{{namespace}}ref_allele","{{namespace[ld]}}state","{{namespace[ld]}}isrefvar"],id_field:"{{namespace}}variant",z_index:2,x_axis:{field:"{{namespace}}position"},y_axis:{axis:1,field:"{{namespace}}log_pvalue",floor:0,upper_buffer:.1,min_extent:[0,10]},transition:{duration:200},highlighted:{onmouseover:"on",onmouseout:"off"},selected:{onclick:"toggle_exclusive",onshiftclick:"toggle"},tooltip:{closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:"<strong>{{{{namespace}}variant}}</strong><br>P Value: <strong>{{{{namespace}}log_pvalue|logtoscinotation}}</strong><br>Ref. Allele: <strong>{{{{namespace}}ref_allele}}</strong><br>"}}),i.Layouts.add("data_layer","phewas_pvalues",{id:"phewaspvalues",type:"scatter",point_shape:"circle",point_size:70,id_field:"{{namespace}}id",transition:{duration:500},fields:["{{namespace}}id","{{namespace}}x","{{namespace}}category_name","{{namespace}}num_cases","{{namespace}}num_controls","{{namespace}}phewas_string","{{namespace}}phewas_code","{{namespace}}pval|scinotation","{{namespace}}pval|neglog10"],x_axis:{field:"{{namespace}}x"},y_axis:{axis:1,field:"{{namespace}}pval|neglog10",floor:0,upper_buffer:.1},color:{field:"{{namespace}}category_name",scale_function:"categorical_bin",parameters:{categories:["infectious diseases","neoplasms","endocrine/metabolic","hematopoietic","mental disorders","neurological","sense organs","circulatory system","respiratory","digestive","genitourinary","pregnancy complications","dermatologic","musculoskeletal","congenital anomalies","symptoms","injuries & poisonings"],values:["rgba(57,59,121,0.7)","rgba(82,84,163,0.7)","rgba(107,110,207,0.7)","rgba(156,158,222,0.7)","rgba(99,121,57,0.7)","rgba(140,162,82,0.7)","rgba(181,207,107,0.7)","rgba(140,109,49,0.7)","rgba(189,158,57,0.7)","rgba(231,186,82,0.7)","rgba(132,60,57,0.7)","rgba(173,73,74,0.7)","rgba(214,97,107,0.7)","rgba(231,150,156,0.7)","rgba(123,65,115,0.7)","rgba(165,81,148,0.7)","rgba(206,109,189,0.7)","rgba(222,158,214,0.7)"],null_value:"#B8B8B8"}},tooltip:{closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:"<div><strong>{{{{namespace}}phewas_string}}</strong></div><div>P Value: <strong>{{{{namespace}}pval|scinotation}}</strong></div>"},highlighted:{onmouseover:"on",onmouseout:"off"},selected:{onclick:"toggle_exclusive",onshiftclick:"toggle"},label:{text:"{{{{namespace}}phewas_string}}",spacing:6,lines:{style:{"stroke-width":"2px",stroke:"#333333","stroke-dasharray":"2px 2px"}},filters:[{field:"{{namespace}}pval|neglog10",operator:">=",value:5}],style:{"font-size":"14px","font-weight":"bold",fill:"#333333"}}}),i.Layouts.add("data_layer","genes",{namespace:{gene:"gene",constraint:"constraint"},id:"genes",type:"genes",fields:["{{namespace[gene]}}gene","{{namespace[constraint]}}constraint"],id_field:"gene_id",highlighted:{onmouseover:"on",onmouseout:"off"},selected:{onclick:"toggle_exclusive",onshiftclick:"toggle"},transition:{duration:200},tooltip:{closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:'<h4><strong><i>{{gene_name}}</i></strong></h4><div style="float: left;">Gene ID: <strong>{{gene_id}}</strong></div><div style="float: right;">Transcript ID: <strong>{{transcript_id}}</strong></div><div style="clear: both;"></div><table><tr><th>Constraint</th><th>Expected variants</th><th>Observed variants</th><th>Const. Metric</th></tr><tr><td>Synonymous</td><td>{{exp_syn}}</td><td>{{n_syn}}</td><td>z = {{syn_z}}</td></tr><tr><td>Missense</td><td>{{exp_mis}}</td><td>{{n_mis}}</td><td>z = {{mis_z}}</td></tr><tr><td>LoF</td><td>{{exp_lof}}</td><td>{{n_lof}}</td><td>pLI = {{pLI}}</td></tr></table><table width="100%"><tr>'+"<td><button onclick=\"LocusZoom.getToolTipPlot(this).panel_ids_by_y_index.forEach(function(panel){ if(panel == 'genes'){ return; } var filters = (panel.indexOf('intervals') != -1 ? [['intervals:start','>=','{{start}}'],['intervals:end','<=','{{end}}']] : [['position','>','{{start}}'],['position','<','{{end}}']]); LocusZoom.getToolTipPlot(this).panels[panel].undimElementsByFilters(filters, true); }.bind(this)); LocusZoom.getToolTipPanel(this).data_layers.genes.unselectAllElements();\">Identify data in region</button></td><td style=\"text-align: right;\"><a href=\"http://exac.broadinstitute.org/gene/{{gene_id}}\" target=\"_new\">More data on ExAC</a></td></tr></table>"}}),i.Layouts.add("data_layer","genome_legend",{namespace:"genome",id:"genome_legend",type:"genome_legend",fields:["{{namespace}}chr","{{namespace}}base_pairs"],x_axis:{floor:0,ceiling:2881033286}}),i.Layouts.add("data_layer","intervals",{namespace:{intervals:"intervals"},id:"intervals",type:"intervals",fields:["{{namespace[intervals]}}start","{{namespace[intervals]}}end","{{namespace[intervals]}}state_id","{{namespace[intervals]}}state_name"],id_field:"{{namespace[intervals]}}start",start_field:"{{namespace[intervals]}}start",end_field:"{{namespace[intervals]}}end",track_split_field:"{{namespace[intervals]}}state_id",split_tracks:!1,color:{field:"{{namespace[intervals]}}state_id",scale_function:"categorical_bin",parameters:{categories:[1,2,3,4,5,6,7,8,9,10,11,12,13],values:["rgb(212,63,58)","rgb(250,120,105)","rgb(252,168,139)","rgb(240,189,66)","rgb(250,224,105)","rgb(240,238,84)","rgb(244,252,23)","rgb(23,232,252)","rgb(32,191,17)","rgb(23,166,77)","rgb(32,191,17)","rgb(162,133,166)","rgb(212,212,212)"],null_value:"#B8B8B8"}},legend:[{shape:"rect",color:"rgb(212,63,58)",width:9,label:"Active Promoter","{{namespace[intervals]}}state_id":1},{shape:"rect",color:"rgb(250,120,105)",width:9,label:"Weak Promoter","{{namespace[intervals]}}state_id":2},{shape:"rect",color:"rgb(252,168,139)",width:9,label:"Poised Promoter","{{namespace[intervals]}}state_id":3},{shape:"rect",color:"rgb(240,189,66)",width:9,label:"Strong enhancer","{{namespace[intervals]}}state_id":4},{shape:"rect",color:"rgb(250,224,105)",width:9,label:"Strong enhancer","{{namespace[intervals]}}state_id":5},{shape:"rect",color:"rgb(240,238,84)",width:9,label:"Weak enhancer","{{namespace[intervals]}}state_id":6},{shape:"rect",color:"rgb(244,252,23)",width:9,label:"Weak enhancer","{{namespace[intervals]}}state_id":7},{shape:"rect",color:"rgb(23,232,252)",width:9,label:"Insulator","{{namespace[intervals]}}state_id":8},{shape:"rect",color:"rgb(32,191,17)",width:9,label:"Transcriptional transition","{{namespace[intervals]}}state_id":9},{shape:"rect",color:"rgb(23,166,77)",width:9,label:"Transcriptional elongation","{{namespace[intervals]}}state_id":10},{shape:"rect",color:"rgb(136,240,129)",width:9,label:"Weak transcribed","{{namespace[intervals]}}state_id":11},{shape:"rect",color:"rgb(162,133,166)",width:9,label:"Polycomb-repressed","{{namespace[intervals]}}state_id":12},{shape:"rect",color:"rgb(212,212,212)",width:9,label:"Heterochromatin / low signal","{{namespace[intervals]}}state_id":13}],highlighted:{onmouseover:"on",onmouseout:"off"},selected:{onclick:"toggle_exclusive",onshiftclick:"toggle"},transition:{duration:200},tooltip:{closable:!1,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:"{{{{namespace[intervals]}}state_name}}<br>{{{{namespace[intervals]}}start}}-{{{{namespace[intervals]}}end}}"}}),i.Layouts.add("dashboard","standard_panel",{components:[{type:"remove_panel",position:"right",color:"red"},{type:"move_panel_up",position:"right"},{type:"move_panel_down",position:"right"}]}),i.Layouts.add("dashboard","standard_plot",{components:[{type:"title",title:"LocusZoom",subtitle:'<a href="https://statgen.github.io/locuszoom/" target="_blank">v'+i.version+"</a>",position:"left"},{type:"dimensions",position:"right"},{type:"region_scale",position:"right"},{type:"download",position:"right"}]}),i.Layouts.add("panel","association",{id:"association",title:"",width:800,height:225,min_width:400,min_height:200,proportional_width:1,margin:{top:35,right:50,bottom:40,left:50},inner_border:"rgba(210, 210, 210, 0.85)",dashboard:function(){var t=i.Layouts.get("dashboard","standard_panel",{unnamespaced:!0});return t.components.push({type:"toggle_legend",position:"right",color:"green"}),t}(),axes:{x:{label_function:"chromosome",label_offset:32,tick_format:"region",extent:"state"},y1:{label:"-log10 p-value",label_offset:28},y2:{label:"Recombination Rate (cM/Mb)",label_offset:40}},legend:{orientation:"vertical",origin:{x:55,y:40},hidden:!0},interaction:{drag_background_to_pan:!0,drag_x_ticks_to_scale:!0,drag_y1_ticks_to_scale:!0,drag_y2_ticks_to_scale:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[i.Layouts.get("data_layer","signifigance",{unnamespaced:!0}),i.Layouts.get("data_layer","recomb_rate",{unnamespaced:!0}),i.Layouts.get("data_layer","association_pvalues",{unnamespaced:!0})]}),i.Layouts.add("panel","genes",{id:"genes",width:800,height:225,min_width:400,min_height:112.5,proportional_width:1,margin:{top:20,right:50,bottom:20,left:50},axes:{},interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},dashboard:function(){var t=i.Layouts.get("dashboard","standard_panel",{unnamespaced:!0});return t.components.push({type:"resize_to_data",position:"right",color:"blue"}),t}(),data_layers:[i.Layouts.get("data_layer","genes",{unnamespaced:!0})]}),i.Layouts.add("panel","phewas",{id:"phewas",width:800,height:300,min_width:800,min_height:300,proportional_width:1,margin:{top:20,right:50,bottom:120,left:50},inner_border:"rgba(210, 210, 210, 0.85)",axes:{x:{ticks:[{x:0,text:"Infectious Disease",style:{fill:"#393b79","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:44,text:"Neoplasms",style:{fill:"#5254a3","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:174,text:"Endocrine/Metabolic",style:{fill:"#6b6ecf","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:288,text:"Hematopoietic",style:{fill:"#9c9ede","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:325,text:"Mental Disorders",style:{fill:"#637939","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:384,text:"Neurological",style:{fill:"#8ca252","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:451,text:"Sense Organs",style:{fill:"#b5cf6b","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:558,text:"Circulatory System",style:{fill:"#8c6d31","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:705,text:"Respiratory",style:{fill:"#bd9e39","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:778,text:"Digestive",style:{fill:"#e7ba52","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:922,text:"Genitourinary",style:{fill:"#843c39","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:1073,text:"Pregnancy Complications",style:{fill:"#ad494a","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:1097,text:"Dermatologic",style:{fill:"#d6616b","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:1170,text:"Musculoskeletal",style:{fill:"#e7969c","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:1282,text:"Congenital Anomalies",style:{fill:"#7b4173","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:1323,text:"Symptoms",style:{fill:"#a55194","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"},{x:1361,text:"Injuries & Poisonings",style:{fill:"#ce6dbd","font-weight":"bold","font-size":"11px","text-anchor":"start"},transform:"translate(15, 0) rotate(50)"}]},y1:{label:"-log10 p-value",label_offset:28}},data_layers:[i.Layouts.get("data_layer","signifigance",{unnamespaced:!0}),i.Layouts.get("data_layer","phewas_pvalues",{unnamespaced:!0})]}),i.Layouts.add("panel","genome_legend",{id:"genome_legend",width:800,height:50,origin:{x:0,y:300},min_width:800,min_height:50,proportional_width:1,margin:{top:0,right:50,bottom:35,left:50},axes:{x:{label:"Genomic Position (number denotes chromosome)",label_offset:35,ticks:[{x:124625310,text:"1",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:370850307,text:"2",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:591461209,text:"3",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:786049562,text:"4",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:972084330,text:"5",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:1148099493,text:"6",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:1313226358,text:"7",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:1465977701,text:"8",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:1609766427,text:"9",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:1748140516,text:"10",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:1883411148,text:"11",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2017840353,text:"12",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2142351240,text:"13",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2253610949,text:"14",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2358551415,text:"15",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2454994487,text:"16",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2540769469,text:"17",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2620405698,text:"18",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2689008813,text:"19",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2750086065,text:"20",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2805663772,text:"21",style:{fill:"rgb(120, 120, 186)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"},{x:2855381003,text:"22",style:{fill:"rgb(0, 0, 66)","text-anchor":"center","font-size":"14px","font-weight":"bold"},transform:"translate(0, 2)"}]}},data_layers:[i.Layouts.get("data_layer","genome_legend",{unnamespaced:!0})]}),i.Layouts.add("panel","intervals",{id:"intervals",width:1e3,height:50,min_width:500,min_height:50,margin:{top:25,right:150,bottom:5,left:50},dashboard:function(){var t=i.Layouts.get("dashboard","standard_panel",{unnamespaced:!0});return t.components.push({type:"toggle_split_tracks",data_layer_id:"intervals",position:"right",color:"yellow"}),t}(),axes:{},interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},legend:{hidden:!0,orientation:"horizontal",origin:{x:50,y:0},pad_from_bottom:5},data_layers:[i.Layouts.get("data_layer","intervals",{unnamespaced:!0})]}),i.Layouts.add("plot","standard_association",{state:{},width:800,height:450,resizable:"responsive",min_region_scale:2e4,max_region_scale:4e6,dashboard:i.Layouts.get("dashboard","standard_plot",{unnamespaced:!0}),panels:[i.Layouts.get("panel","association",{unnamespaced:!0,proportional_height:.5}),i.Layouts.get("panel","genes",{unnamespaced:!0,proportional_height:.5})]}),i.StandardLayout=i.Layouts.get("plot","standard_association"),i.Layouts.add("plot","standard_phewas",{width:800,height:600,min_width:800,min_height:600,responsive_resize:!0,dashboard:i.Layouts.get("dashboard","standard_plot",{unnamespaced:!0}),panels:[i.Layouts.get("panel","phewas",{unnamespaced:!0,proportional_height:.45}),i.Layouts.get("panel","genome_legend",{unnamespaced:!0,proportional_height:.1}),i.Layouts.get("panel","genes",{unnamespaced:!0,proportional_height:.45})]}),i.Layouts.add("plot","interval_association",{state:{},width:800,height:550,resizable:"responsive",min_region_scale:2e4,max_region_scale:4e6,dashboard:i.Layouts.get("dashboard","standard_plot",{unnamespaced:!0}),panels:[i.Layouts.get("panel","association",{unnamespaced:!0,width:800,proportional_height:225/570}),i.Layouts.get("panel","intervals",{unnamespaced:!0,proportional_height:120/570}),i.Layouts.get("panel","genes",{unnamespaced:!0,width:800,proportional_height:225/570})]}),i.DataLayer=function(t,e){return this.initialized=!1,this.layout_idx=null,this.id=null,this.parent=e||null,this.svg={},this.parent_plot=null,"undefined"!=typeof e&&e instanceof i.Panel&&(this.parent_plot=e.parent),this.layout=i.Layouts.merge(t||{},i.DataLayer.DefaultLayout),this.layout.id&&(this.id=this.layout.id),this.layout.x_axis!={}&&"number"!=typeof this.layout.x_axis.axis&&(this.layout.x_axis.axis=1),this.layout.y_axis!={}&&"number"!=typeof this.layout.y_axis.axis&&(this.layout.y_axis.axis=1),this.parent?(this.state=this.parent.state,this.state_id=this.parent.id+"."+this.id,this.state[this.state_id]=this.state[this.state_id]||{},i.DataLayer.Statuses.adjectives.forEach(function(t){this.state[this.state_id][t]=this.state[this.state_id][t]||[]}.bind(this))):(this.state={},this.state_id=null),this.data=[],this.layout.tooltip&&(this.tooltips={}),this},i.DataLayer.DefaultLayout={type:"",fields:[],x_axis:{},y_axis:{}},i.DataLayer.Statuses={verbs:["highlight","select","dim","hide"],adjectives:["highlighted","selected","dimmed","hidden"]},i.DataLayer.prototype.getBaseId=function(){return this.parent_plot.id+"."+this.parent.id+"."+this.id},i.DataLayer.prototype.getAbsoluteDataHeight=function(){var t=this.svg.group.node().getBoundingClientRect();return t.height},i.DataLayer.prototype.canTransition=function(){return!!this.layout.transition&&!(this.parent_plot.panel_boundaries.dragging||this.parent.interactions.dragging||this.parent.interactions.zooming)},i.DataLayer.prototype.getElementId=function(t){var e="element";if("string"==typeof t)e=t;else if("object"==typeof t){var i=this.layout.id_field||"id";if("undefined"==typeof t[i])throw"Unable to generate element ID";e=t[i].toString().replace(/\W/g,"")}return(this.getBaseId()+"-"+e).replace(/(:|\.|\[|\]|,)/g,"_")},i.DataLayer.prototype.getElementById=function(t){var e=d3.select("#"+t.replace(/(:|\.|\[|\]|,)/g,"\\$1"));return!e.empty()&&e.data()&&e.data().length?e.data()[0]:null},i.DataLayer.prototype.applyDataMethods=function(){return this.data.forEach(function(t,e){this.data[e].toHTML=function(){var t=this.layout.id_field||"id",i="";return this.data[e][t]&&(i=this.data[e][t].toString()),i}.bind(this),this.data[e].getDataLayer=function(){return this}.bind(this),this.data[e].deselect=function(){var t=this.getDataLayer();t.unselectElement(this)}}.bind(this)),this.applyCustomDataMethods(),this},i.DataLayer.prototype.applyCustomDataMethods=function(){return this},i.DataLayer.prototype.initialize=function(){return this.svg.container=this.parent.svg.group.append("g").attr("id",this.getBaseId()+".data_layer_container"),this.svg.clipRect=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip").append("rect"),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".data_layer").attr("clip-path","url(#"+this.getBaseId()+".clip)"),this},i.DataLayer.prototype.resolveScalableParameter=function(t,e){var a=null;if(Array.isArray(t))for(var n=0;null==a&&n<t.length;)a=this.resolveScalableParameter(t[n],e),n++;else switch(typeof t){case"number":case"string":a=t;break;case"object":t.scale_function&&t.field&&(a=i.ScaleFunctions.get(t.scale_function,t.parameters||{},e[t.field]))}return a},i.DataLayer.prototype.getAxisExtent=function(t){if(["x","y"].indexOf(t)==-1)throw"Invalid dimension identifier passed to LocusZoom.DataLayer.getAxisExtent()";var e=t+"_axis";if(!isNaN(this.layout[e].floor)&&!isNaN(this.layout[e].ceiling))return[+this.layout[e].floor,+this.layout[e].ceiling];if(this.layout[e].field&&this.data&&this.data.length){var i=d3.extent(this.data,function(t){return+t[this.layout[e].field]}.bind(this)),a=i[1]-i[0];return isNaN(this.layout[e].lower_buffer)||i.push(i[0]-a*this.layout[e].lower_buffer),isNaN(this.layout[e].upper_buffer)||i.push(i[1]+a*this.layout[e].upper_buffer),"object"!=typeof this.layout[e].min_extent||isNaN(this.layout[e].min_extent[0])||isNaN(this.layout[e].min_extent[1])||i.push(this.layout[e].min_extent[0],this.layout[e].min_extent[1]),
i=d3.extent(i),isNaN(this.layout[e].floor)||(i[0]=this.layout[e].floor),isNaN(this.layout[e].ceiling)||(i[1]=this.layout[e].ceiling),i}return"x"!=t||isNaN(this.state.start)||isNaN(this.state.end)?[]:[this.state.start,this.state.end]},i.DataLayer.prototype.createTooltip=function(t,e){if("object"!=typeof this.layout.tooltip)throw"DataLayer ["+this.id+"] layout does not define a tooltip";return"undefined"==typeof e&&(e=this.getElementId(t)),this.tooltips[e]?void this.positionTooltip(e):(this.tooltips[e]={data:t,arrow:null,selector:d3.select(this.parent_plot.svg.node().parentNode).append("div").attr("class","lz-data_layer-tooltip").attr("id",e+"-tooltip")},this.updateTooltip(t),this)},i.DataLayer.prototype.updateTooltip=function(t,e){return"undefined"==typeof e&&(e=this.getElementId(t)),this.tooltips[e].selector.html(""),this.tooltips[e].arrow=null,this.layout.tooltip.html&&this.tooltips[e].selector.html(i.parseFields(t,this.layout.tooltip.html)),this.layout.tooltip.closable&&(this.tooltips[e].selector.style("padding-right","24px"),this.tooltips[e].selector.append("button").attr("class","lz-tooltip-close-button").attr("title","Close").text("×").on("click",function(){this.destroyTooltip(e)}.bind(this))),this.tooltips[e].selector.data([t]),this.positionTooltip(e),this},i.DataLayer.prototype.destroyTooltip=function(t,e){return"string"==typeof t?e=t:"undefined"==typeof e&&(e=this.getElementId(t)),this.tooltips[e]&&("object"==typeof this.tooltips[e].selector&&this.tooltips[e].selector.remove(),delete this.tooltips[e]),this},i.DataLayer.prototype.destroyAllTooltips=function(){for(var t in this.tooltips)this.destroyTooltip(t);return this},i.DataLayer.prototype.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";return this.tooltips[t].selector.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"),this.tooltips[t].arrow||(this.tooltips[t].arrow=this.tooltips[t].selector.append("div").style("position","absolute").attr("class","lz-data_layer-tooltip-arrow_top_left")),this.tooltips[t].arrow.style("left","-1px").style("top","-1px"),this},i.DataLayer.prototype.positionAllTooltips=function(){for(var t in this.tooltips)this.positionTooltip(t);return this},i.DataLayer.prototype.showOrHideTooltip=function(t){if("object"==typeof this.layout.tooltip){var e=this.getElementId(t),a=function(t,e,i){var n=null;if("object"!=typeof t||null==t)return null;if(Array.isArray(e))"undefined"==typeof i&&(i="and"),n=1==e.length?t[e[0]]:e.reduce(function(e,a){return"and"==i?t[e]&&t[a]:"or"==i?t[e]||t[a]:null});else if("object"==typeof e){var s;for(var o in e)s=a(t,e[o],o),null==n?n=s:"and"==i?n=n&&s:"or"==i&&(n=n||s)}return n},n={};"string"==typeof this.layout.tooltip.show?n={and:[this.layout.tooltip.show]}:"object"==typeof this.layout.tooltip.show&&(n=this.layout.tooltip.show);var s={};"string"==typeof this.layout.tooltip.hide?s={and:[this.layout.tooltip.hide]}:"object"==typeof this.layout.tooltip.hide&&(s=this.layout.tooltip.hide);var o={};i.DataLayer.Statuses.adjectives.forEach(function(t){var i="un"+t;o[t]=this.state[this.state_id][t].indexOf(e)!=-1,o[i]=!o[t]}.bind(this));var r=a(o,n),l=a(o,s);return r&&!l?this.createTooltip(t):this.destroyTooltip(t),this}},i.DataLayer.prototype.filter=function(t,e){if("undefined"!=typeof e&&["indexes","elements"].indexOf(e)!=-1||(e="indexes"),!Array.isArray(t))return[];var i=function(t,e){var i={"=":function(t,e){return t==e},"<":function(t,e){return t<e},"<=":function(t,e){return t<=e},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"%":function(t,e){return t%e}};return!!Array.isArray(e)&&(2==e.length?t[e[0]]==e[1]:!(3!=e.length||!i[e[1]])&&i[e[1]](t[e[0]],e[2]))},a=[];return this.data.forEach(function(n,s){var o=!0;t.forEach(function(t){i(n,t)||(o=!1)}),o&&a.push("indexes"==e?s:n)}),a},i.DataLayer.prototype.filterIndexes=function(t){return this.filter(t,"indexes")},i.DataLayer.prototype.filterElements=function(t){return this.filter(t,"elements")},i.DataLayer.Statuses.verbs.forEach(function(t,e){var a=i.DataLayer.Statuses.adjectives[e],n="un"+t;i.DataLayer.prototype[t+"Element"]=function(t,e){return e="undefined"!=typeof e&&!!e,this.setElementStatus(a,t,!0,e),this},i.DataLayer.prototype[n+"Element"]=function(t,e){return e="undefined"!=typeof e&&!!e,this.setElementStatus(a,t,!1,e),this},i.DataLayer.prototype[t+"ElementsByFilters"]=function(t,e){return e="undefined"!=typeof e&&!!e,this.setElementStatusByFilters(a,!0,t,e)},i.DataLayer.prototype[n+"ElementsByFilters"]=function(t,e){return e="undefined"!=typeof e&&!!e,this.setElementStatusByFilters(a,!1,t,e)},i.DataLayer.prototype[t+"AllElements"]=function(){return this.setAllElementStatus(a,!0),this},i.DataLayer.prototype[n+"AllElements"]=function(){return this.setAllElementStatus(a,!1),this}}),i.DataLayer.prototype.setElementStatus=function(t,e,a,n){if("undefined"==typeof t||i.DataLayer.Statuses.adjectives.indexOf(t)==-1)throw"Invalid status passed to DataLayer.setElementStatus()";if("undefined"==typeof e)throw"Invalid element passed to DataLayer.setElementStatus()";"undefined"==typeof a&&(a=!0);try{var s=this.getElementId(e)}catch(o){return this}if(n&&this.setAllElementStatus(t,!a),d3.select("#"+s).classed("lz-data_layer-"+this.layout.type+"-"+t,a),this.layout.hover_element){var r="lz-data_layer-"+this.layout.type+"-"+this.layout.hover_element+"-"+t,l=d3.select("#"+s+"_"+this.layout.hover_element);this.layout.group_hover_elements_on_field&&(l=this.group_hover_elements[e[this.layout.group_hover_elements_on_field]]),l.classed(r,a)}var h=this.state[this.state_id][t].indexOf(s);return a&&h==-1&&this.state[this.state_id][t].push(s),a||h==-1||this.state[this.state_id][t].splice(h,1),this.showOrHideTooltip(e),this.parent.emit("layout_changed"),this.parent_plot.emit("layout_changed"),this},i.DataLayer.prototype.setElementStatusByFilters=function(t,e,a,n){if("undefined"==typeof t||i.DataLayer.Statuses.adjectives.indexOf(t)==-1)throw"Invalid status passed to DataLayer.setElementStatusByFilters()";return"undefined"==typeof this.state[this.state_id][t]?this:(e="undefined"==typeof e||!!e,n="undefined"!=typeof n&&!!n,Array.isArray(a)||(a=[]),n&&this.setAllElementStatus(t,!e),this.filterElements(a).forEach(function(i){this.setElementStatus(t,i,e)}.bind(this)),this)},i.DataLayer.prototype.setAllElementStatus=function(t,e){if("undefined"==typeof t||i.DataLayer.Statuses.adjectives.indexOf(t)==-1)throw"Invalid status passed to DataLayer.setAllElementStatus()";if("undefined"==typeof this.state[this.state_id][t])return this;if("undefined"==typeof e&&(e=!0),e)this.data.forEach(function(e){this.setElementStatus(t,e,!0)}.bind(this));else{var a=this.state[this.state_id][t].slice();a.forEach(function(e){var i=this.getElementById(e);"object"==typeof i&&null!=i&&this.setElementStatus(t,i,!1)}.bind(this))}return this},i.DataLayer.prototype.applyStatusBehavior=function(t,e){if("undefined"!=typeof t&&i.DataLayer.Statuses.adjectives.indexOf(t)!=-1&&"object"==typeof e&&"object"==typeof this.layout[t]&&this.layout[t]){var a={mouseover:["onmouseover","onctrlmouseover","onshiftmouseover","onctrlshiftmouseover"],mouseout:["onmouseout"],click:["onclick","onctrlclick","onshiftclick","onctrlshiftclick"]},n=function(t,e,i){var n=null,s=d3.event.ctrlKey,o=d3.event.shiftKey;if(a[e]){var r="on"+e,l="on"+(s?"ctrl":"")+(o?"shift":"")+e,h=this.layout[t][l]||this.layout[t][r]||null;if(h){switch(h){case"on":n=!0;break;case"off":n=!1;break;case"toggle":case"toggle_exclusive":n=this.state[this.state_id][t].indexOf(this.getElementId(i))==-1}null!=n&&(n&&"toggle_exclusive"==h&&this.setAllElementStatus(t,!1),this.setElementStatus(t,i,n),"click"==e&&(this.parent.emit("element_clicked",i),this.parent_plot.emit("element_clicked",i)))}}}.bind(this),s={};return Object.keys(a).forEach(function(t){s[t]=!1}),Object.keys(this.layout[t]).forEach(function(t){Object.keys(a).forEach(function(e){a[e].indexOf(t)!=-1&&(s[e]=!0)})}),Object.keys(s).forEach(function(i){s[i]&&e.on(i,function(e){n(t,i,e)}.bind(this))}.bind(this)),this}},i.DataLayer.prototype.applyAllStatusBehaviors=function(t){return i.DataLayer.Statuses.adjectives.forEach(function(e){this.applyStatusBehavior(e,t)}.bind(this)),this},i.DataLayer.prototype.getPageOrigin=function(){var t=this.parent.getPageOrigin();return{x:t.x+this.parent.layout.margin.left,y:t.y+this.parent.layout.margin.top}},i.DataLayer.prototype.draw=function(){return this.svg.container.attr("transform","translate("+this.parent.layout.cliparea.origin.x+","+this.parent.layout.cliparea.origin.y+")"),this.svg.clipRect.attr("width",this.parent.layout.cliparea.width).attr("height",this.parent.layout.cliparea.height),this.positionAllTooltips(),this},i.DataLayer.prototype.reMap=function(){this.destroyAllTooltips();var t=this.parent_plot.lzd.getData(this.state,this.layout.fields);return t.then(function(t){this.data=t.body,this.applyDataMethods(),this.initialized=!0}.bind(this)),t},i.DataLayers=function(){var t={},e={};return t.get=function(t,i,a){if(t){if(e[t]){if("object"!=typeof i)throw"invalid layout argument for data layer ["+t+"]";return new e[t](i,a)}throw"data layer ["+t+"] not found"}return null},t.set=function(t,a){if(a){if("function"!=typeof a)throw"unable to set data layer ["+t+"], argument provided is not a function";e[t]=a,e[t].prototype=new i.DataLayer}else delete e[t]},t.add=function(i,a){if(e[i])throw"data layer already exists with name: "+i;t.set(i,a)},t.list=function(){return Object.keys(e)},t}(),i.DataLayers.add("scatter",function(t){return this.DefaultLayout={point_size:40,point_shape:"circle",color:"#888888",y_axis:{axis:1},id_field:"id"},t=i.Layouts.merge(t,this.DefaultLayout),t.label&&isNaN(t.label.spacing)&&(t.label.spacing=4),i.DataLayer.apply(this,arguments),this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";if(!this.tooltips[t])throw"Unable to position tooltip: id does not point to a valid tooltip";var e,i,a,n=this.tooltips[t],s=this.resolveScalableParameter(this.layout.point_size,n.data),o=7,r=1,l=6,h=this.getPageOrigin(),d=this.parent.x_scale(n.data[this.layout.x_axis.field]),u="y"+this.layout.y_axis.axis+"_scale",p=this.parent[u](n.data[this.layout.y_axis.field]),c=n.selector.node().getBoundingClientRect(),y=Math.sqrt(s/Math.PI);d<=this.parent.layout.width/2?(e=h.x+d+y+o+r,i="left",a=-1*(o+r)):(e=h.x+d-c.width-y-o-r,i="right",a=c.width-r);var g,f,_=this.parent.layout.height-(this.parent.layout.margin.top+this.parent.layout.margin.bottom);p-c.height/2<=0?(g=h.y+p-1.5*o-l,f=l):p+c.height/2>=_?(g=h.y+p+o+l-c.height,f=c.height-2*o-l):(g=h.y+p-c.height/2,f=c.height/2-o),n.selector.style("left",e+"px").style("top",g+"px"),n.arrow||(n.arrow=n.selector.append("div").style("position","absolute")),n.arrow.attr("class","lz-data_layer-tooltip-arrow_"+i).style("left",a+"px").style("top",f+"px")},this.flip_labels=function(){var t=this,e=t.resolveScalableParameter(t.layout.point_size,{}),i=t.layout.label.spacing,a=Boolean(t.layout.label.lines),n=2*i,s=t.parent.layout.width-t.parent.layout.margin.left-t.parent.layout.margin.right-2*i,o=function(t,n){var s=+t.attr("x"),o=2*i+2*Math.sqrt(e);if(a)var r=+n.attr("x2"),l=i+2*Math.sqrt(e);"start"==t.style("text-anchor")?(t.style("text-anchor","end"),t.attr("x",s-o),a&&n.attr("x2",r-l)):(t.style("text-anchor","start"),t.attr("x",s+o),a&&n.attr("x2",r+l))};t.label_texts.each(function(e,n){var r=this,l=d3.select(r),h=+l.attr("x"),d=l.node().getBoundingClientRect();if(h+d.width+i>s){var u=a?d3.select(t.label_lines[0][n]):null;o(l,u)}}),t.label_texts.each(function(e,s){var r=this,l=d3.select(r);if("end"!=l.style("text-anchor")){var h=+l.attr("x"),d=l.node().getBoundingClientRect(),u=a?d3.select(t.label_lines[0][s]):null;t.label_texts.each(function(){var t=this,e=d3.select(t),a=e.node().getBoundingClientRect(),s=d.left<a.left+a.width+2*i&&d.left+d.width+2*i>a.left&&d.top<a.top+a.height+2*i&&d.height+d.top+2*i>a.top;s&&(o(l,u),h=+l.attr("x"),h-d.width-i<n&&o(l,u))})}})},this.separate_labels=function(){this.seperate_iterations++;var t=this,e=.5,i=this.layout.label.spacing,a=!1;if(t.label_texts.each(function(){var n=this,s=d3.select(n),o=s.attr("y");t.label_texts.each(function(){var r=this;if(n!=r){var l=d3.select(r);if(s.attr("text-anchor")==l.attr("text-anchor")){var h=s.node().getBoundingClientRect(),d=l.node().getBoundingClientRect(),u=h.left<d.left+d.width+2*i&&h.left+h.width+2*i>d.left&&h.top<d.top+d.height+2*i&&h.height+h.top+2*i>d.top;if(u){a=!0;var p,c=l.attr("y"),y=h.top<d.top?1:-1,g=y*e,f=+o-g,_=+c+g,m=2*i,b=t.parent.layout.height-t.parent.layout.margin.top-t.parent.layout.margin.bottom-2*i;f-h.height/2<m?(p=+o-f,f=+o,_+=p):_-d.height/2<m&&(p=+c-_,_=+c,f+=p),f+h.height/2>b?(p=f-+o,f=+o,_-=p):_+d.height/2>b&&(p=_-+c,_=+c,f-=p),s.attr("y",f),l.attr("y",_)}}}})}),a){if(t.layout.label.lines){var n=t.label_texts[0];t.label_lines.attr("y2",function(t,e){var i=d3.select(n[e]);return i.attr("y")})}this.seperate_iterations<150&&setTimeout(function(){this.separate_labels()}.bind(this),1)}},this.render=function(){var t=this,e="x_scale",a="y"+this.layout.y_axis.axis+"_scale";if(this.layout.label){var n=this.data.filter(function(e){if(t.layout.label.filters){var i=!0;return t.layout.label.filters.forEach(function(t){if(isNaN(e[t.field]))i=!1;else switch(t.operator){case"<":e[t.field]<t.value||(i=!1);break;case"<=":e[t.field]<=t.value||(i=!1);break;case">":e[t.field]>t.value||(i=!1);break;case">=":e[t.field]>=t.value||(i=!1);break;case"=":e[t.field]!=t.value&&(i=!1);break;default:i=!1}}),i}return!0});this.label_groups=this.svg.group.selectAll("g.lz-data_layer-scatter-label").data(n,function(t){return t.id+"_label"}),this.label_groups.enter().append("g").attr("class","lz-data_layer-scatter-label"),this.label_texts&&this.label_texts.remove(),this.label_texts=this.label_groups.append("text").attr("class","lz-data_layer-scatter-label"),this.label_texts.text(function(e){return i.parseFields(e,t.layout.label.text||"")}).style(t.layout.label.style||{}).attr({x:function(i){var a=t.parent[e](i[t.layout.x_axis.field])+Math.sqrt(t.resolveScalableParameter(t.layout.point_size,i))+t.layout.label.spacing;return isNaN(a)&&(a=-1e3),a},y:function(e){var i=t.parent[a](e[t.layout.y_axis.field]);return isNaN(i)&&(i=-1e3),i},"text-anchor":function(){return"start"}}),t.layout.label.lines&&(this.label_lines&&this.label_lines.remove(),this.label_lines=this.label_groups.append("line").attr("class","lz-data_layer-scatter-label"),this.label_lines.style(t.layout.label.lines.style||{}).attr({x1:function(i){var a=t.parent[e](i[t.layout.x_axis.field]);return isNaN(a)&&(a=-1e3),a},y1:function(e){var i=t.parent[a](e[t.layout.y_axis.field]);return isNaN(i)&&(i=-1e3),i},x2:function(i){var a=t.parent[e](i[t.layout.x_axis.field])+Math.sqrt(t.resolveScalableParameter(t.layout.point_size,i))+t.layout.label.spacing/2;return isNaN(a)&&(a=-1e3),a},y2:function(e){var i=t.parent[a](e[t.layout.y_axis.field]);return isNaN(i)&&(i=-1e3),i}})),this.label_groups.exit().remove()}var s=this.svg.group.selectAll("path.lz-data_layer-scatter").data(this.data,function(t){return t[this.layout.id_field]}.bind(this)),o=isNaN(this.parent.layout.height)?0:this.parent.layout.height;s.enter().append("path").attr("class","lz-data_layer-scatter").attr("id",function(t){return this.getElementId(t)}.bind(this)).attr("transform","translate(0,"+o+")");var r=function(t){var i=this.parent[e](t[this.layout.x_axis.field]),n=this.parent[a](t[this.layout.y_axis.field]);return isNaN(i)&&(i=-1e3),isNaN(n)&&(n=-1e3),"translate("+i+","+n+")"}.bind(this),l=function(t){return this.resolveScalableParameter(this.layout.color,t)}.bind(this),h=d3.svg.symbol().size(function(t){return this.resolveScalableParameter(this.layout.point_size,t)}.bind(this)).type(function(t){return this.resolveScalableParameter(this.layout.point_shape,t)}.bind(this));this.canTransition()?s.transition().duration(this.layout.transition.duration||0).ease(this.layout.transition.ease||"cubic-in-out").attr("transform",r).attr("fill",l).attr("d",h):s.attr("transform",r).attr("fill",l).attr("d",h),s.exit().remove(),s.on("click",function(t){this.parent.emit("element_clicked",t),this.parent_plot.emit("element_clicked",t)}.bind(this)),this.applyAllStatusBehaviors(s),this.layout.label&&(this.flip_labels(),this.seperate_iterations=0,this.separate_labels())},this}),i.DataLayers.add("line",function(t){return this.DefaultLayout={style:{fill:"none","stroke-width":"2px"},interpolate:"linear",x_axis:{field:"x"},y_axis:{field:"y",axis:1},hitarea_width:5},t=i.Layouts.merge(t,this.DefaultLayout),this.mouse_event=null,this.line=null,this.tooltip_timeout=null,i.DataLayer.apply(this,arguments),this.getMouseDisplayAndData=function(){var t={display:{x:d3.mouse(this.mouse_event)[0],y:null},data:{},slope:null},e=this.layout.x_axis.field,i=this.layout.y_axis.field,a="x_scale",n="y"+this.layout.y_axis.axis+"_scale";t.data[e]=this.parent[a].invert(t.display.x);var s=d3.bisector(function(t){return+t[e]}).left,o=s(this.data,t.data[e])-1,r=this.data[o],l=this.data[o+1],h=d3.interpolateNumber(+r[i],+l[i]),d=+l[e]-+r[e];return t.data[i]=h(t.data[e]%d/d),t.display.y=this.parent[n](t.data[i]),this.layout.tooltip.x_precision&&(t.data[e]=t.data[e].toPrecision(this.layout.tooltip.x_precision)),this.layout.tooltip.y_precision&&(t.data[i]=t.data[i].toPrecision(this.layout.tooltip.y_precision)),t.slope=(this.parent[n](l[i])-this.parent[n](r[i]))/(this.parent[a](l[e])-this.parent[a](r[e])),t},this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";if(!this.tooltips[t])throw"Unable to position tooltip: id does not point to a valid tooltip";var e,i,a,n,s,o=this.tooltips[t],r=o.selector.node().getBoundingClientRect(),l=7,h=6,d=parseFloat(this.layout.style["stroke-width"])||1,u=this.getPageOrigin(),p=this.parent.layout.height-(this.parent.layout.margin.top+this.parent.layout.margin.bottom),c=this.parent.layout.width-(this.parent.layout.margin.left+this.parent.layout.margin.right),y=this.getMouseDisplayAndData();if(Math.abs(y.slope)>1)y.display.x<=this.parent.layout.width/2?(i=u.x+y.display.x+d+l+d,s="left",n=-1*(l+d)):(i=u.x+y.display.x-r.width-d-l-d,s="right",n=r.width-d),y.display.y-r.height/2<=0?(e=u.y+y.display.y-1.5*l-h,a=h):y.display.y+r.height/2>=p?(e=u.y+y.display.y+l+h-r.height,a=r.height-2*l-h):(e=u.y+y.display.y-r.height/2,a=r.height/2-l);else{var g=Math.max(r.width/2-y.display.x,0),f=Math.max(r.width/2+y.display.x-c,0);i=u.x+y.display.x-r.width/2-f+g;var _=l/2,m=r.width-2.5*l;n=r.width/2-l+f-g,n=Math.min(Math.max(n,_),m),r.height+d+l>y.display.y?(e=u.y+y.display.y+d+l,s="up",a=0-d-l):(e=u.y+y.display.y-(r.height+d+l),s="down",a=r.height-d)}o.selector.style({left:i+"px",top:e+"px"}),o.arrow||(o.arrow=o.selector.append("div").style("position","absolute")),o.arrow.attr("class","lz-data_layer-tooltip-arrow_"+s).style({left:n+"px",top:a+"px"})},this.render=function(){var t=this,e=this.parent,i=this.layout.x_axis.field,a=this.layout.y_axis.field,n="x_scale",s="y"+this.layout.y_axis.axis+"_scale",o=this.svg.group.selectAll("path.lz-data_layer-line").data([this.data]);if(o.enter().append("path").attr("class","lz-data_layer-line"),this.line=d3.svg.line().x(function(t){return e[n](t[i])}).y(function(t){return e[s](t[a])}).interpolate(this.layout.interpolate),this.canTransition()?o.transition().duration(this.layout.transition.duration||0).ease(this.layout.transition.ease||"cubic-in-out").attr("d",this.line).style(this.layout.style):o.attr("d",this.line).style(this.layout.style),this.layout.tooltip){var r=parseFloat(this.layout.hitarea_width).toString()+"px",l=this.svg.group.selectAll("path.lz-data_layer-line-hitarea").data([this.data]);l.enter().append("path").attr("class","lz-data_layer-line-hitarea").style("stroke-width",r);var h=d3.svg.line().x(function(t){return e[n](t[i])}).y(function(t){return e[s](t[a])}).interpolate(this.layout.interpolate);l.attr("d",h).on("mouseover",function(){clearTimeout(t.tooltip_timeout),t.mouse_event=this;var e=t.getMouseDisplayAndData();t.createTooltip(e.data)}).on("mousemove",function(){clearTimeout(t.tooltip_timeout),t.mouse_event=this;var e=t.getMouseDisplayAndData();t.updateTooltip(e.data),t.positionTooltip(t.getElementId())}).on("mouseout",function(){t.tooltip_timeout=setTimeout(function(){t.mouse_event=null,t.destroyTooltip(t.getElementId())},300)}),l.exit().remove()}o.exit().remove()},this}),i.DataLayers.add("genes",function(t){return this.DefaultLayout={label_font_size:12,label_exon_spacing:4,exon_height:16,bounding_box_padding:6,track_vertical_spacing:10,hover_element:"bounding_box"},t=i.Layouts.merge(t,this.DefaultLayout),i.DataLayer.apply(this,arguments),this.getTrackHeight=function(){return 2*this.layout.bounding_box_padding+this.layout.label_font_size+this.layout.label_exon_spacing+this.layout.exon_height+this.layout.track_vertical_spacing},this.transcript_idx=0,this.tracks=1,this.gene_track_index={1:[]},this.assignTracks=function(){return this.getLabelWidth=function(t,e){var i=this.svg.group.append("text").attr("x",0).attr("y",0).attr("class","lz-data_layer-genes lz-label").style("font-size",e).text(t+"→"),a=i.node().getBBox().width;return i.remove(),a},this.tracks=1,this.gene_track_index={1:[]},this.data.map(function(t,e){if(this.data[e].gene_id&&this.data[e].gene_id.indexOf(".")){var i=this.data[e].gene_id.split(".");this.data[e].gene_id=i[0],this.data[e].gene_version=i[1]}if(this.data[e].transcript_id=this.data[e].transcripts[this.transcript_idx].transcript_id,this.data[e].display_range={start:this.parent.x_scale(Math.max(t.start,this.state.start)),end:this.parent.x_scale(Math.min(t.end,this.state.end))},this.data[e].display_range.label_width=this.getLabelWidth(this.data[e].gene_name,this.layout.label_font_size),this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start,this.data[e].display_range.text_anchor="middle",this.data[e].display_range.width<this.data[e].display_range.label_width){if(t.start<this.state.start)this.data[e].display_range.end=this.data[e].display_range.start+this.data[e].display_range.label_width+this.layout.label_font_size,this.data[e].display_range.text_anchor="start";else if(t.end>this.state.end)this.data[e].display_range.start=this.data[e].display_range.end-this.data[e].display_range.label_width-this.layout.label_font_size,this.data[e].display_range.text_anchor="end";else{var a=(this.data[e].display_range.label_width-this.data[e].display_range.width)/2+this.layout.label_font_size;this.data[e].display_range.start-a<this.parent.x_scale(this.state.start)?(this.data[e].display_range.start=this.parent.x_scale(this.state.start),this.data[e].display_range.end=this.data[e].display_range.start+this.data[e].display_range.label_width,this.data[e].display_range.text_anchor="start"):this.data[e].display_range.end+a>this.parent.x_scale(this.state.end)?(this.data[e].display_range.end=this.parent.x_scale(this.state.end),this.data[e].display_range.start=this.data[e].display_range.end-this.data[e].display_range.label_width,this.data[e].display_range.text_anchor="end"):(this.data[e].display_range.start-=a,this.data[e].display_range.end+=a)}this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start}this.data[e].display_range.start-=this.layout.bounding_box_padding,this.data[e].display_range.end+=this.layout.bounding_box_padding,this.data[e].display_range.width+=2*this.layout.bounding_box_padding,this.data[e].display_domain={start:this.parent.x_scale.invert(this.data[e].display_range.start),end:this.parent.x_scale.invert(this.data[e].display_range.end)},this.data[e].display_domain.width=this.data[e].display_domain.end-this.data[e].display_domain.start,this.data[e].track=null;for(var n=1;null==this.data[e].track;){var s=!1;this.gene_track_index[n].map(function(t){if(!s){var e=Math.min(t.display_range.start,this.display_range.start),i=Math.max(t.display_range.end,this.display_range.end);i-e<t.display_range.width+this.display_range.width&&(s=!0)}}.bind(this.data[e])),s?(n++,n>this.tracks&&(this.tracks=n,this.gene_track_index[n]=[])):(this.data[e].track=n,this.gene_track_index[n].push(this.data[e]))}this.data[e].parent=this,this.data[e].transcripts.map(function(t,i){this.data[e].transcripts[i].parent=this.data[e],this.data[e].transcripts[i].exons.map(function(t,a){this.data[e].transcripts[i].exons[a].parent=this.data[e].transcripts[i]}.bind(this))}.bind(this))}.bind(this)),this},this.render=function(){this.assignTracks();var t,e,i,a,n=this.svg.group.selectAll("g.lz-data_layer-genes").data(this.data,function(t){return t.gene_name});n.enter().append("g").attr("class","lz-data_layer-genes"),n.attr("id",function(t){return this.getElementId(t)}.bind(this)).each(function(n){var s=n.parent,o=d3.select(this).selectAll("rect.lz-data_layer-genes.lz-data_layer-genes-bounding_box").data([n],function(t){return t.gene_name+"_bbox"});o.enter().append("rect").attr("class","lz-data_layer-genes lz-data_layer-genes-bounding_box"),o.attr("id",function(t){return s.getElementId(t)+"_bounding_box"}).attr("rx",function(){return s.layout.bounding_box_padding}).attr("ry",function(){return s.layout.bounding_box_padding}),t=function(t){return t.display_range.width},e=function(){return s.getTrackHeight()-s.layout.track_vertical_spacing},i=function(t){return t.display_range.start},a=function(t){return(t.track-1)*s.getTrackHeight()},s.canTransition()?o.transition().duration(s.layout.transition.duration||0).ease(s.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a):o.attr("width",t).attr("height",e).attr("x",i).attr("y",a),o.exit().remove();var r=d3.select(this).selectAll("rect.lz-data_layer-genes.lz-boundary").data([n],function(t){return t.gene_name+"_boundary"});r.enter().append("rect").attr("class","lz-data_layer-genes lz-boundary"),t=function(t){return s.parent.x_scale(t.end)-s.parent.x_scale(t.start)},e=function(){return 1},i=function(t){return s.parent.x_scale(t.start)},a=function(t){return(t.track-1)*s.getTrackHeight()+s.layout.bounding_box_padding+s.layout.label_font_size+s.layout.label_exon_spacing+Math.max(s.layout.exon_height,3)/2},s.canTransition()?r.transition().duration(s.layout.transition.duration||0).ease(s.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a):r.attr("width",t).attr("height",e).attr("x",i).attr("y",a),r.exit().remove();var l=d3.select(this).selectAll("text.lz-data_layer-genes.lz-label").data([n],function(t){return t.gene_name+"_label"});l.enter().append("text").attr("class","lz-data_layer-genes lz-label"),l.attr("text-anchor",function(t){return t.display_range.text_anchor}).text(function(t){return"+"==t.strand?t.gene_name+"→":"←"+t.gene_name}).style("font-size",n.parent.layout.label_font_size),i=function(t){return"middle"==t.display_range.text_anchor?t.display_range.start+t.display_range.width/2:"start"==t.display_range.text_anchor?t.display_range.start+s.layout.bounding_box_padding:"end"==t.display_range.text_anchor?t.display_range.end-s.layout.bounding_box_padding:void 0},a=function(t){return(t.track-1)*s.getTrackHeight()+s.layout.bounding_box_padding+s.layout.label_font_size},s.canTransition()?l.transition().duration(s.layout.transition.duration||0).ease(s.layout.transition.ease||"cubic-in-out").attr("x",i).attr("y",a):l.attr("x",i).attr("y",a),l.exit().remove();var h=d3.select(this).selectAll("rect.lz-data_layer-genes.lz-exon").data(n.transcripts[n.parent.transcript_idx].exons,function(t){return t.exon_id});h.enter().append("rect").attr("class","lz-data_layer-genes lz-exon"),t=function(t){return s.parent.x_scale(t.end)-s.parent.x_scale(t.start)},e=function(){return s.layout.exon_height},i=function(t){return s.parent.x_scale(t.start)},a=function(){return(n.track-1)*s.getTrackHeight()+s.layout.bounding_box_padding+s.layout.label_font_size+s.layout.label_exon_spacing},s.canTransition()?h.transition().duration(s.layout.transition.duration||0).ease(s.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a):h.attr("width",t).attr("height",e).attr("x",i).attr("y",a),h.exit().remove();var d=d3.select(this).selectAll("rect.lz-data_layer-genes.lz-clickarea").data([n],function(t){return t.gene_name+"_clickarea"});d.enter().append("rect").attr("class","lz-data_layer-genes lz-clickarea"),d.attr("id",function(t){return s.getElementId(t)+"_clickarea"}).attr("rx",function(){return s.layout.bounding_box_padding}).attr("ry",function(){return s.layout.bounding_box_padding}),t=function(t){return t.display_range.width},e=function(){return s.getTrackHeight()-s.layout.track_vertical_spacing},i=function(t){return t.display_range.start},a=function(t){return(t.track-1)*s.getTrackHeight()},s.canTransition()?d.transition().duration(s.layout.transition.duration||0).ease(s.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a):d.attr("width",t).attr("height",e).attr("x",i).attr("y",a),d.exit().remove(),d.on("click",function(t){this.parent.emit("element_clicked",t),this.parent_plot.emit("element_clicked",t)}.bind(this)),s.applyAllStatusBehaviors(d)}),n.exit().remove()},this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";if(!this.tooltips[t])throw"Unable to position tooltip: id does not point to a valid tooltip";var e,i,a,n=this.tooltips[t],s=7,o=1,r=this.getPageOrigin(),l=n.selector.node().getBoundingClientRect(),h=this.getElementId(n.data)+"_bounding_box",d=d3.select("#"+h).node().getBBox(),u=this.parent.layout.height-(this.parent.layout.margin.top+this.parent.layout.margin.bottom),p=this.parent.layout.width-(this.parent.layout.margin.left+this.parent.layout.margin.right),c=(n.data.display_range.start+n.data.display_range.end)/2-this.layout.bounding_box_padding/2,y=Math.max(l.width/2-c,0),g=Math.max(l.width/2+c-p,0),f=r.x+c-l.width/2-g+y,_=l.width/2-s/2+g-y;l.height+o+s>u-(d.y+d.height)?(e=r.y+d.y-(l.height+o+s),i="down",a=l.height-o):(e=r.y+d.y+d.height+o+s,i="up",a=0-o-s),n.selector.style("left",f+"px").style("top",e+"px"),n.arrow||(n.arrow=n.selector.append("div").style("position","absolute")),n.arrow.attr("class","lz-data_layer-tooltip-arrow_"+i).style("left",_+"px").style("top",a+"px")},this}),i.DataLayers.add("intervals",function(t){return this.DefaultLayout={start_field:"start",end_field:"end",track_split_field:"state_id",track_split_order:"DESC",track_split_legend_to_y_axis:2,split_tracks:!0,track_height:15,track_vertical_spacing:3,bounding_box_padding:2,hover_element:"bounding_box",group_hover_elements_on_field:null,always_hide_legend:!1},t=i.Layouts.merge(t,this.DefaultLayout),i.DataLayer.apply(this,arguments),this.getTrackHeight=function(){return this.layout.track_height+this.layout.track_vertical_spacing+2*this.layout.bounding_box_padding},this.tracks=1,this.previous_tracks=1,this.group_hover_elements={},this.interval_track_index={1:[]},this.assignTracks=function(){if(this.previous_tracks=this.tracks,this.tracks=0,this.interval_track_index={1:[]},this.track_split_field_index={},this.layout.track_split_field&&this.layout.split_tracks){this.data.map(function(t){this.track_split_field_index[t[this.layout.track_split_field]]=null}.bind(this));var t=Object.keys(this.track_split_field_index);"DESC"==this.layout.track_split_order&&t.reverse(),t.forEach(function(t){this.track_split_field_index[t]=this.tracks+1,this.interval_track_index[this.tracks+1]=[],this.tracks++}.bind(this))}return this.data.map(function(t,e){if(this.data[e].parent=this,this.data[e].display_range={start:this.parent.x_scale(Math.max(t[this.layout.start_field],this.state.start)),end:this.parent.x_scale(Math.min(t[this.layout.end_field],this.state.end))},this.data[e].display_range.width=this.data[e].display_range.end-this.data[e].display_range.start,this.data[e].display_domain={start:this.parent.x_scale.invert(this.data[e].display_range.start),end:this.parent.x_scale.invert(this.data[e].display_range.end)},
this.data[e].display_domain.width=this.data[e].display_domain.end-this.data[e].display_domain.start,this.layout.track_split_field&&this.layout.split_tracks){var i=this.data[e][this.layout.track_split_field];this.data[e].track=this.track_split_field_index[i],this.interval_track_index[this.data[e].track].push(e)}else{this.tracks=1,this.data[e].track=null;for(var a=1;null==this.data[e].track;){var n=!1;this.interval_track_index[a].map(function(t){if(!n){var e=Math.min(t.display_range.start,this.display_range.start),i=Math.max(t.display_range.end,this.display_range.end);i-e<t.display_range.width+this.display_range.width&&(n=!0)}}.bind(this.data[e])),n?(a++,a>this.tracks&&(this.tracks=a,this.interval_track_index[a]=[])):(this.data[e].track=a,this.interval_track_index[a].push(this.data[e]))}}}.bind(this)),this},this.render=function(){this.assignTracks(),this.layout.split_tracks?(Object.keys(this.group_hover_elements).forEach(function(t){this.track_split_field_index[t]||this.group_hover_elements[t].remove()}.bind(this)),Object.keys(this.track_split_field_index).forEach(function(t){this.group_hover_elements[t]||(this.group_hover_elements[t]=this.svg.group.insert("rect",":first-child").attr("class","lz-data_layer-intervals lz-data_layer-intervals-bounding_box")),this.group_hover_elements[t].attr("rx",this.layout.bounding_box_padding).attr("ry",this.layout.bounding_box_padding).attr("width",this.parent.layout.cliparea.width).attr("height",this.getTrackHeight()-this.layout.track_vertical_spacing).attr("x",0).attr("y",(this.track_split_field_index[t]-1)*this.getTrackHeight())}.bind(this))):(Object.keys(this.group_hover_elements).forEach(function(t){this.group_hover_elements[t].remove()}.bind(this)),this.group_hover_elements={});var t,e,i,a,n,s=this.svg.group.selectAll("g.lz-data_layer-intervals").data(this.data,function(t){return t[this.layout.id_field]}.bind(this));return s.enter().append("g").attr("class","lz-data_layer-intervals"),s.attr("id",function(t){return this.getElementId(t)}.bind(this)).each(function(s){var o=s.parent,r=d3.select(this).selectAll("rect.lz-data_layer-intervals.lz-data_layer-intervals-bounding_box").data([s],function(t){return t[o.layout.id_field]+"_bbox"});o.layout.split_tracks?r.remove():(r.enter().append("rect").attr("class","lz-data_layer-intervals lz-data_layer-intervals-bounding_box"),r.attr("id",function(t){return o.getElementId(t)+"_bounding_box"}).attr("rx",function(){return o.layout.bounding_box_padding}).attr("ry",function(){return o.layout.bounding_box_padding}),t=function(t){return t.display_range.width+2*o.layout.bounding_box_padding},e=function(){return o.getTrackHeight()-o.layout.track_vertical_spacing},i=function(t){return t.display_range.start-o.layout.bounding_box_padding},a=function(t){return(t.track-1)*o.getTrackHeight()},o.canTransition()?r.transition().duration(o.layout.transition.duration||0).ease(o.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a):r.attr("width",t).attr("height",e).attr("x",i).attr("y",a),r.exit().remove());var l=d3.select(this).selectAll("rect.lz-data_layer-intervals.lz-interval_rect").data([s],function(t){return t[o.layout.id_field]+"_interval_rect"});l.enter().append("rect").attr("class","lz-data_layer-intervals lz-interval_rect"),e=o.layout.track_height,t=function(t){return t.display_range.width},i=function(t){return t.display_range.start},a=function(t){return(t.track-1)*o.getTrackHeight()+o.layout.bounding_box_padding},n=function(t){return o.resolveScalableParameter(o.layout.color,t)},o.canTransition()?l.transition().duration(o.layout.transition.duration||0).ease(o.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a).attr("fill",n):l.attr("width",t).attr("height",e).attr("x",i).attr("y",a).attr("fill",n),l.exit().remove();var h=d3.select(this).selectAll("rect.lz-data_layer-intervals.lz-clickarea").data([s],function(t){return t.interval_name+"_clickarea"});h.enter().append("rect").attr("class","lz-data_layer-intervals lz-clickarea"),h.attr("id",function(t){return o.getElementId(t)+"_clickarea"}).attr("rx",function(){return o.layout.bounding_box_padding}).attr("ry",function(){return o.layout.bounding_box_padding}),t=function(t){return t.display_range.width},e=function(){return o.getTrackHeight()-o.layout.track_vertical_spacing},i=function(t){return t.display_range.start},a=function(t){return(t.track-1)*o.getTrackHeight()},o.canTransition()?h.transition().duration(o.layout.transition.duration||0).ease(o.layout.transition.ease||"cubic-in-out").attr("width",t).attr("height",e).attr("x",i).attr("y",a):h.attr("width",t).attr("height",e).attr("x",i).attr("y",a),h.exit().remove(),h.on("click",function(t){this.parent.emit("element_clicked",t),this.parent_plot.emit("element_clicked",t)}.bind(this)),o.applyAllStatusBehaviors(h)}),s.exit().remove(),this.previous_tracks!=this.tracks&&this.updateSplitTrackAxis(),this},this.positionTooltip=function(t){if("string"!=typeof t)throw"Unable to position tooltip: id is not a string";if(!this.tooltips[t])throw"Unable to position tooltip: id does not point to a valid tooltip";var e,i=this.tooltips[t],a=7,n=1,s=this.getPageOrigin(),o=i.selector.node().getBoundingClientRect();e=this.layout.split_tracks?d3.select("#"+this.getElementId(i.data)).node().getBBox():d3.select("#"+this.getElementId(i.data)+"_bounding_box").node().getBBox();var r,l,h,d=this.parent.layout.height-(this.parent.layout.margin.top+this.parent.layout.margin.bottom),u=this.parent.layout.width-(this.parent.layout.margin.left+this.parent.layout.margin.right),p=(i.data.display_range.start+i.data.display_range.end)/2-this.layout.bounding_box_padding/2,c=Math.max(o.width/2-p,0),y=Math.max(o.width/2+p-u,0),g=s.x+p-o.width/2-y+c,f=o.width/2-a/2+y-c;o.height+n+a>d-(e.y+e.height)?(r=s.y+e.y-(o.height+n+a),l="down",h=o.height-n):(r=s.y+e.y+e.height+n+a,l="up",h=0-n-a),i.selector.style("left",g+"px").style("top",r+"px"),i.arrow||(i.arrow=i.selector.append("div").style("position","absolute")),i.arrow.attr("class","lz-data_layer-tooltip-arrow_"+l).style("left",f+"px").style("top",h+"px")},this.updateSplitTrackAxis=function(){var t=!!this.layout.track_split_legend_to_y_axis&&"y"+this.layout.track_split_legend_to_y_axis;if(this.layout.split_tracks){var e=+this.tracks||0,i=+this.layout.track_height||0,a=2*(+this.layout.bounding_box_padding||0)+(+this.layout.track_vertical_spacing||0),n=e*i+(e-1)*a;this.parent.scaleHeightToData(n),t&&this.parent.legend&&(this.parent.legend.hide(),this.parent.layout.axes[t]={render:!0,ticks:[],range:{start:n-this.layout.track_height/2,end:this.layout.track_height/2}},this.layout.legend.forEach(function(i){var a=i[this.layout.track_split_field],n=this.track_split_field_index[a];n&&("DESC"==this.layout.track_split_order&&(n=Math.abs(n-e-1)),this.parent.layout.axes[t].ticks.push({x:n,text:i.label}))}.bind(this)),this.layout.y_axis={axis:this.layout.track_split_legend_to_y_axis,floor:1,ceiling:e},this.parent.render())}else t&&this.parent.legend&&(this.layout.always_hide_legend||this.parent.legend.show(),this.parent.layout.axes[t]={render:!1},this.parent.render());return this},this.toggleSplitTracks=function(){return this.layout.split_tracks=!this.layout.split_tracks,this.layout.group_hover_elements_on_field=this.layout.split_tracks?this.layout.track_split_field:null,this.parent.legend&&!this.layout.always_hide_legend&&(this.parent.layout.margin.bottom=5+(this.layout.split_tracks?0:this.parent.legend.layout.height+5)),this.render(),this.updateSplitTrackAxis(),this},this}),i.KnownDataSources=function(){var t={},e=[],i=function(t){for(var i=0;i<e.length;i++){if(!e[i].SOURCE_NAME)throw"KnownDataSources at position "+i+" does not have a 'SOURCE_NAME' static property";if(e[i].SOURCE_NAME==t)return e[i]}return null};return t.get=function(t){return i(t)},t.add=function(t){t.SOURCE_NAME||console.warn("Data source added does not have a SOURCE_NAME"),e.push(t)},t.push=function(e){console.warn("Warning: KnownDataSources.push() is depricated. Use .add() instead"),t.add(e)},t.list=function(){return e.map(function(t){return t.SOURCE_NAME})},t.create=function(t){var e=i(t);if(e){var a=arguments;return a[0]=null,new(Function.prototype.bind.apply(e,a))}throw"Unable to find data source for name: "+t},t.getAll=function(){return e},t.setAll=function(t){e=t},t.clear=function(){e=[]},t}(),i.LabelFunctions=function(){var t={},e={};return t.get=function(t,i){if(t){if(e[t])return"undefined"==typeof i?e[t]:e[t](i);throw"label function ["+t+"] not found"}return null},t.set=function(t,i){i?e[t]=i:delete e[t]},t.add=function(i,a){if(e[i])throw"label function already exists with name: "+i;t.set(i,a)},t.list=function(){return Object.keys(e)},t}(),i.LabelFunctions.add("chromosome",function(t){return isNaN(+t.chr)?"Chromosome (Mb)":"Chromosome "+t.chr+" (Mb)"}),i.TransformationFunctions=function(){var t={},e={},i=function(t){if(!t)return null;var i=e[t];if(i)return i;throw"transformation "+t+" not found"},a=function(t){return i(t)},n=function(t){for(var e,i=[],n=/\|([^\|]+)/g;null!=(e=n.exec(t));)i.push(e[1]);return 1==i.length?a(i[0]):i.length>1?function(t){for(var e=t,n=0;n<i.length;n++)e=a(i[n])(e);return e}:null};return t.get=function(t){return t&&"|"==t.substring(0,1)?n(t):a(t)},t.set=function(t,i){if("|"==t.substring(0,1))throw"transformation name should not start with a pipe";i?e[t]=i:delete e[t]},t.add=function(i,a){if(e[i])throw"transformation already exists with name: "+i;t.set(i,a)},t.list=function(){return Object.keys(e)},t}(),i.TransformationFunctions.add("neglog10",function(t){return-Math.log(t)/Math.LN10}),i.TransformationFunctions.add("logtoscinotation",function(t){var e=Math.ceil(t),i=e-t,a=Math.pow(10,i);return a.toFixed(2)+" × 10^"+e}),i.TransformationFunctions.add("scinotation",function(t){var e;return e=Math.abs(t)>1?Math.ceil(Math.log(t)/Math.LN10):Math.floor(Math.log(t)/Math.LN10),Math.abs(e)<=3?t.toFixed(3):t.toExponential(2).replace("+","").replace("e"," × 10^")}),i.ScaleFunctions=function(){var t={},e={};return t.get=function(t,i,a){if(t){if(e[t])return"undefined"==typeof i&&"undefined"==typeof a?e[t]:e[t](i,a);throw"scale function ["+t+"] not found"}return null},t.set=function(t,i){i?e[t]=i:delete e[t]},t.add=function(i,a){if(e[i])throw"scale function already exists with name: "+i;t.set(i,a)},t.list=function(){return Object.keys(e)},t}(),i.ScaleFunctions.add("if",function(t,e){return"undefined"==typeof e||t.field_value!=e?"undefined"!=typeof t["else"]?t["else"]:null:t.then}),i.ScaleFunctions.add("numerical_bin",function(t,e){var i=t.breaks,a=t.values;if("undefined"==typeof e||null==e||isNaN(+e))return t.null_value?t.null_value:null;var n=i.reduce(function(t,i){return+e<t||+e>=t&&+e<i?t:i});return a[i.indexOf(n)]}),i.ScaleFunctions.add("categorical_bin",function(t,e){return"undefined"==typeof e||t.categories.indexOf(e)==-1?t.null_value?t.null_value:null:t.values[t.categories.indexOf(e)]}),i.Dashboard=function(t){if(!(t instanceof i.Plot||t instanceof i.Panel))throw"Unable to create dashboard, parent must be a locuszoom plot or panel";return this.parent=t,this.id=this.parent.getBaseId()+".dashboard",this.type=this.parent instanceof i.Plot?"plot":"panel",this.selector=null,this.components=[],this.hide_timeout=null,this.persist=!1,this.initialize()},i.Dashboard.prototype.initialize=function(){return Array.isArray(this.parent.layout.dashboard.components)&&this.parent.layout.dashboard.components.forEach(function(t){try{var e=i.Dashboard.Components.get(t.type,t,this);this.components.push(e)}catch(a){console.warn(a)}}.bind(this)),"panel"==this.type&&(d3.select(this.parent.parent.svg.node().parentNode).on("mouseover."+this.id,function(){clearTimeout(this.hide_timeout),this.show()}.bind(this)),d3.select(this.parent.parent.svg.node().parentNode).on("mouseout."+this.id,function(){this.hide_timeout=setTimeout(function(){this.hide()}.bind(this),300)}.bind(this))),this},i.Dashboard.prototype.shouldPersist=function(){if(this.persist)return!0;var t=!1;return this.components.forEach(function(e){t=t||e.shouldPersist()}),t="plot"==this.type?t||this.parent.panel_boundaries.dragging:t||!!this.parent.parent.panel_boundaries.dragging||!!this.parent.interactions.dragging},i.Dashboard.prototype.show=function(){if(!this.selector){switch(this.type){case"plot":this.selector=d3.select(this.parent.svg.node().parentNode).insert("div",":first-child");break;case"panel":this.selector=d3.select(this.parent.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip, .lz-dashboard-menu, .lz-curtain").classed("lz-panel-dashboard",!0)}this.selector.classed("lz-dashboard",!0).classed("lz-"+this.type+"-dashboard",!0).attr("id",this.id)}return this.components.forEach(function(t){t.show()}),this.selector.style({visibility:"visible"}),this.update()},i.Dashboard.prototype.update=function(){return this.selector?(this.components.forEach(function(t){t.update()}),this.position()):this},i.Dashboard.prototype.position=function(){if(!this.selector)return this;if("panel"==this.type){var t=this.parent.getPageOrigin(),e=this.selector.node().getBoundingClientRect(),i=(t.y+3).toString()+"px",a=(t.x+this.parent.layout.width-e.width).toString()+"px";this.selector.style({position:"absolute",top:i,left:a})}return this.components.forEach(function(t){t.position()}),this},i.Dashboard.prototype.hide=function(){return!this.selector||this.shouldPersist()?this:(this.components.forEach(function(t){t.hide()}),this.selector.style({visibility:"hidden"}),this)},i.Dashboard.prototype.destroy=function(t){return"undefined"==typeof t&&(t=!1),this.selector?this.shouldPersist()&&!t?this:(this.components.forEach(function(t){t.destroy(!0)}),this.components=[],this.selector.remove(),this.selector=null,this):this},i.Dashboard.Component=function(t,e){return this.layout=t||{},this.layout.color||(this.layout.color="gray"),this.parent=e||null,this.parent_panel=null,this.parent_plot=null,this.parent_svg=null,this.parent instanceof i.Dashboard&&("panel"==this.parent.type?(this.parent_panel=this.parent.parent,this.parent_plot=this.parent.parent.parent,this.parent_svg=this.parent_panel):(this.parent_plot=this.parent.parent,this.parent_svg=this.parent_plot)),this.selector=null,this.button=null,this.persist=!1,this.layout.position||(this.layout.position="left"),this},i.Dashboard.Component.prototype.show=function(){if(this.parent&&this.parent.selector)return this.selector||(this.selector=this.parent.selector.append("div").attr("class","lz-dashboard-"+this.layout.position),"function"==typeof this.initialize&&this.initialize()),this.button&&"highlighted"==this.button.status&&this.button.menu.show(),this.selector.style({visibility:"visible"}),this.update(),this.position()},i.Dashboard.Component.prototype.update=function(){},i.Dashboard.Component.prototype.position=function(){return this.button&&this.button.menu.position(),this},i.Dashboard.Component.prototype.shouldPersist=function(){return!!this.persist||!(!this.button||!this.button.persist)},i.Dashboard.Component.prototype.hide=function(){return!this.selector||this.shouldPersist()?this:(this.button&&this.button.menu.hide(),this.selector.style({visibility:"hidden"}),this)},i.Dashboard.Component.prototype.destroy=function(t){return"undefined"==typeof t&&(t=!1),this.selector?this.shouldPersist()&&!t?this:(this.button&&this.button.menu&&this.button.menu.destroy(),this.selector.remove(),this.selector=null,this.button=null,this):this},i.Dashboard.Components=function(){var t={},e={};return t.get=function(t,i,a){if(t){if(e[t]){if("object"!=typeof i)throw"invalid layout argument for dashboard component ["+t+"]";return new e[t](i,a)}throw"dashboard component ["+t+"] not found"}return null},t.set=function(t,a){if(a){if("function"!=typeof a)throw"unable to set dashboard component ["+t+"], argument provided is not a function";e[t]=a,e[t].prototype=new i.Dashboard.Component}else delete e[t]},t.add=function(i,a){if(e[i])throw"dashboard component already exists with name: "+i;t.set(i,a)},t.list=function(){return Object.keys(e)},t}(),i.Dashboard.Component.Button=function(t){if(!(t instanceof i.Dashboard.Component))throw"Unable to create dashboard component button, invalid parent";this.parent=t,this.parent_panel=this.parent.parent_panel,this.parent_plot=this.parent.parent_plot,this.parent_svg=this.parent.parent_svg,this.parent_dashboard=this.parent.parent,this.selector=null,this.tag="a",this.setTag=function(t){return"undefined"!=typeof t&&(this.tag=t.toString()),this},this.text="",this.setText=function(t){return"undefined"!=typeof t&&(this.text=t.toString()),this},this.title="",this.setTitle=function(t){return"undefined"!=typeof t&&(this.title=t.toString()),this},this.color="gray",this.setColor=function(t){return"undefined"!=typeof t&&(["gray","red","orange","yellow","green","blue","purple"].indexOf(t)!==-1?this.color=t:this.color="gray"),this},this.style={},this.setStyle=function(t){return"undefined"!=typeof t&&(this.style=t),this},this.persist=!1,this.permanent=!1,this.setPermanent=function(t){return t="undefined"==typeof t||Boolean(t),this.permanent=t,this.permanent&&(this.persist=!0),this},this.shouldPersist=function(){return this.permanent||this.persist},this.status="",this.setStatus=function(t){return"undefined"!=typeof t&&["","highlighted","disabled"].indexOf(t)!==-1&&(this.status=t),this.update()},this.highlight=function(t){return t="undefined"==typeof t||Boolean(t),t?this.setStatus("highlighted"):"highlighted"==this.status?this.setStatus(""):this},this.disable=function(t){return t="undefined"==typeof t||Boolean(t),t?this.setStatus("disabled"):"disabled"==this.status?this.setStatus(""):this},this.onmouseover=function(){},this.setOnMouseover=function(t){return"function"==typeof t?this.onmouseover=t:this.onmouseover=function(){},this},this.onmouseout=function(){},this.setOnMouseout=function(t){return"function"==typeof t?this.onmouseout=t:this.onmouseout=function(){},this},this.onclick=function(){},this.setOnclick=function(t){return"function"==typeof t?this.onclick=t:this.onclick=function(){},this},this.show=function(){if(this.parent)return this.selector||(this.selector=this.parent.selector.append(this.tag).attr("class","lz-dashboard-button")),this.update()},this.preUpdate=function(){return this},this.update=function(){return this.selector?(this.preUpdate(),this.selector.attr("class","lz-dashboard-button lz-dashboard-button-"+this.color+(this.status?"-"+this.status:"")).attr("title",this.title).style(this.style).on("mouseover","disabled"==this.status?null:this.onmouseover).on("mouseout","disabled"==this.status?null:this.onmouseout).on("click","disabled"==this.status?null:this.onclick).text(this.text),this.menu.update(),this.postUpdate(),this):this},this.postUpdate=function(){return this},this.hide=function(){return this.selector&&!this.shouldPersist()&&(this.selector.remove(),this.selector=null),this},this.menu={outer_selector:null,inner_selector:null,hidden:!0,show:function(){return this.menu.outer_selector||(this.menu.outer_selector=d3.select(this.parent_plot.svg.node().parentNode).append("div").attr("class","lz-dashboard-menu lz-dashboard-menu-"+this.color).attr("id",this.parent_svg.getBaseId()+".dashboard.menu"),this.menu.inner_selector=this.menu.outer_selector.append("div").attr("class","lz-dashboard-menu-content")),this.menu.outer_selector.style({visibility:"visible"}),this.menu.hidden=!1,this.menu.update()}.bind(this),update:function(){return this.menu.outer_selector?(this.menu.populate(),this.menu.position()):this.menu}.bind(this),position:function(){if(!this.menu.outer_selector)return this.menu;var t=3,e=20,i=14,a=this.parent_svg.getPageOrigin(),n=this.parent_dashboard.selector.node().getBoundingClientRect(),s=this.selector.node().getBoundingClientRect(),o=this.menu.outer_selector.node().getBoundingClientRect(),r=this.menu.inner_selector.node().scrollHeight+i,l=0,h=0;"panel"==this.parent_dashboard.type?(l=(a.y+n.height+3*t).toString()+"px",h=Math.max(a.x+this.parent_svg.layout.width-o.width-t,a.x+t).toString()+"px"):(l=(s.bottom+t).toString()+"px",h=Math.max(a.x+this.parent_svg.layout.width-o.width,a.x+t).toString()+"px");var d=Math.max(this.parent_svg.layout.width-2*t-e,e),u=d.toString()+"px",p=(d-4*t).toString()+"px",c=Math.max(this.parent_svg.layout.height-7*t-i,i),y=Math.min(r,c).toString()+"px",g=c.toString()+"px";return this.menu.outer_selector.style({top:l,left:h,"max-width":u,"max-height":g,height:y}),this.menu.inner_selector.style({"max-width":p}),this.menu}.bind(this),hide:function(){return this.menu.outer_selector?(this.menu.outer_selector.style({visibility:"hidden"}),this.menu.hidden=!0,this.menu):this.menu}.bind(this),destroy:function(){return this.menu.outer_selector?(this.menu.inner_selector.remove(),this.menu.outer_selector.remove(),this.menu.inner_selector=null,this.menu.outer_selector=null,this.menu):this.menu}.bind(this),populate:function(){}.bind(this),setPopulate:function(t){return"function"==typeof t?(this.menu.populate=t,this.setOnclick(function(){this.menu.hidden?(this.menu.show(),this.highlight().update(),this.persist=!0):(this.menu.hide(),this.highlight(!1).update(),this.permanent||(this.persist=!1))}.bind(this))):this.setOnclick(),this}.bind(this)}},i.Dashboard.Components.add("title",function(t){i.Dashboard.Component.apply(this,arguments),this.show=function(){return this.div_selector=this.parent.selector.append("div").attr("class","lz-dashboard-title lz-dashboard-"+this.layout.position),this.title_selector=this.div_selector.append("h3"),this.update()},this.update=function(){var e=t.title.toString();return this.layout.subtitle&&(e+=" <small>"+this.layout.subtitle+"</small>"),this.title_selector.html(e),this}}),i.Dashboard.Components.add("dimensions",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){var t=this.parent_plot.layout.width.toString().indexOf(".")==-1?this.parent_plot.layout.width:this.parent_plot.layout.width.toFixed(2),e=this.parent_plot.layout.height.toString().indexOf(".")==-1?this.parent_plot.layout.height:this.parent_plot.layout.height.toFixed(2);return this.selector.text(t+"px × "+e+"px"),this}}),i.Dashboard.Components.add("region_scale",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){return isNaN(this.parent_plot.state.start)||isNaN(this.parent_plot.state.end)||null==this.parent_plot.state.start||null==this.parent_plot.state.end?this.selector.style("display","none"):(this.selector.style("display",null),this.selector.text(i.positionIntToString(this.parent_plot.state.end-this.parent_plot.state.start,null,!0))),this}}),i.Dashboard.Components.add("download",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){return this.button?this:(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText("Download Image").setTitle("Download image of the current plot as locuszoom.svg").setOnMouseover(function(){this.button.selector.classed("lz-dashboard-button-gray-disabled",!0).text("Preparing Image"),this.generateBase64SVG().then(function(t){this.button.selector.attr("href","data:image/svg+xml;base64,\n"+t).classed("lz-dashboard-button-gray-disabled",!1).classed("lz-dashboard-button-gray-highlighted",!0).text("Download Image")}.bind(this))}.bind(this)).setOnMouseout(function(){this.button.selector.classed("lz-dashboard-button-gray-highlighted",!1)}.bind(this)),this.button.show(),this.button.selector.attr("href-lang","image/svg+xml").attr("download","locuszoom.svg"),this)},this.css_string="";for(var e in Object.keys(document.styleSheets))if(null!=document.styleSheets[e].href&&document.styleSheets[e].href.indexOf("locuszoom.css")!=-1){i.createCORSPromise("GET",document.styleSheets[e].href).then(function(t){this.css_string=t.replace(/[\r\n]/g," ").replace(/\s+/g," "),this.css_string.indexOf("/* ! LocusZoom HTML Styles */")&&(this.css_string=this.css_string.substring(0,this.css_string.indexOf("/* ! LocusZoom HTML Styles */")))}.bind(this));break}this.generateBase64SVG=function(){return Q.fcall(function(){var t=this.parent.selector.append("div").style("display","none").html(this.parent_plot.svg.node().outerHTML);t.selectAll("g.lz-curtain").remove(),t.selectAll("g.lz-mouse_guide").remove(),t.selectAll("g.tick text").each(function(){var t=10*+d3.select(this).attr("dy").substring(-2).slice(0,-2);d3.select(this).attr("dy",t)});var e=d3.select(t.select("svg").node().parentNode).html(),i='<style type="text/css"><![CDATA[ '+this.css_string+" ]]></style>",a=e.indexOf(">")+1;return e=e.slice(0,a)+i+e.slice(a),t.remove(),btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)}))}.bind(this))}}),i.Dashboard.Components.add("remove_panel",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){return this.button?this:(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText("×").setTitle("Remove panel").setOnclick(function(){var t=this.parent_panel;t.dashboard.hide(!0),d3.select(t.parent.svg.node().parentNode).on("mouseover."+t.getBaseId()+".dashboard",null),d3.select(t.parent.svg.node().parentNode).on("mouseout."+t.getBaseId()+".dashboard",null),t.parent.removePanel(t.id)}.bind(this)),this.button.show(),this)}}),i.Dashboard.Components.add("move_panel_up",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){if(this.button){var e=0==this.parent_panel.layout.y_index;return this.button.disable(e),this}return this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText("▴").setTitle("Move panel up").setOnclick(function(){this.parent_panel.moveUp(),this.update()}.bind(this)),this.button.show(),this.update()}}),i.Dashboard.Components.add("move_panel_down",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){if(this.button){var e=this.parent_panel.layout.y_index==this.parent_plot.panel_ids_by_y_index.length-1;return this.button.disable(e),this}return this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText("▾").setTitle("Move panel down").setOnclick(function(){this.parent_panel.moveDown(),this.update()}.bind(this)),this.button.show(),this.update()}}),i.Dashboard.Components.add("menu",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){return this.button?this:(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText(t.button_html).setTitle(t.button_title),this.button.menu.setPopulate(function(){this.button.menu.inner_selector.html(t.menu_html)}.bind(this)),this.button.show(),this)}}),i.Dashboard.Components.add("covariates_model",function(t){i.Dashboard.Component.apply(this,arguments),this.initialize=function(){this.parent_plot.state.model=this.parent_plot.state.model||{},this.parent_plot.state.model.covariates=this.parent_plot.state.model.covariates||[],this.parent_plot.CovariatesModel={button:this,add:function(t){for(var e=0;e<this.state.model.covariates.length;e++)if(JSON.stringify(this.state.model.covariates[e])===JSON.stringify(t))return this;return this.state.model.covariates.push(t),this.applyState(),this.CovariatesModel.updateComponent(),this}.bind(this.parent_plot),removeByIdx:function(t){if("undefined"==typeof this.state.model.covariates[t])throw"Unable to remove model covariate, invalid index: "+t.toString();return this.state.model.covariates.splice(t,1),this.applyState(),this.CovariatesModel.updateComponent(),this}.bind(this.parent_plot),removeAll:function(){return this.state.model.covariates=[],this.applyState(),this.CovariatesModel.updateComponent(),this}.bind(this.parent_plot),updateComponent:function(){this.button.update(),this.button.menu.update()}.bind(this)}}.bind(this),this.update=function(){return this.button?this:(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText(t.button_html).setTitle(t.button_title).setOnclick(function(){this.button.menu.populate()}.bind(this)),this.button.menu.setPopulate(function(){var t=this.button.menu.inner_selector;if(t.html(""),"undefined"!=typeof this.parent_plot.state.model.html&&t.append("div").html(this.parent_plot.state.model.html),this.parent_plot.state.model.covariates.length){t.append("h5").html("Model Covariates ("+this.parent_plot.state.model.covariates.length+")");var e=t.append("table");this.parent_plot.state.model.covariates.forEach(function(t,i){var a=t.toString();"object"==typeof t&&"function"==typeof t.toHTML&&(a=t.toHTML());var n=e.append("tr");n.append("td").append("button").attr("class","lz-dashboard-button lz-dashboard-button-"+this.layout.color).style({"margin-left":"0em"}).on("click",function(){this.parent_plot.CovariatesModel.removeByIdx(i)}.bind(this)).text("×"),n.append("td").html(a)}.bind(this)),t.append("button").attr("class","lz-dashboard-button lz-dashboard-button-"+this.layout.color).style({"margin-left":"4px"}).html("× Remove All Covariates").on("click",function(){this.parent_plot.CovariatesModel.removeAll()}.bind(this))}else t.append("i").text("no covariates in model")}.bind(this)),this.button.preUpdate=function(){var t="Model";if(this.parent_plot.state.model.covariates.length){var e=this.parent_plot.state.model.covariates.length>1?"covariates":"covariate";t+=" ("+this.parent_plot.state.model.covariates.length+" "+e+")"}this.button.setText(t).disable(!1)}.bind(this),this.button.show(),this)}}),i.Dashboard.Components.add("toggle_split_tracks",function(t){if(i.Dashboard.Component.apply(this,arguments),t.data_layer_id||(t.data_layer_id="intervals"),!this.parent_panel.data_layers[t.data_layer_id])throw"Dashboard toggle split tracks component missing valid data layer ID";this.update=function(){var e=this.parent_panel.data_layers[t.data_layer_id],a=e.layout.split_tracks?"Merge Tracks":"Split Tracks";return this.button?(this.button.setText(a),this.button.show(),this.parent.position(),this):(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText(a).setTitle("Toggle whether tracks are split apart or merged together").setOnclick(function(){e.toggleSplitTracks(),this.scale_timeout&&clearTimeout(this.scale_timeout),this.scale_timeout=setTimeout(function(){e.layout.split_tracks||this.parent_panel.scaleHeightToData()}.bind(this),+e.layout.transition.duration||0),this.update()}.bind(this)),this.update())}}),i.Dashboard.Components.add("resize_to_data",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){return this.button?this:(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setText("Resize to Data").setTitle("Automatically resize this panel to fit the data its currently showing").setOnclick(function(){this.parent_panel.scaleHeightToData(),this.update()}.bind(this)),this.button.show(),this)}}),i.Dashboard.Components.add("toggle_legend",function(t){i.Dashboard.Component.apply(this,arguments),this.update=function(){var e=this.parent_panel.legend.layout.hidden?"Show Legend":"Hide Legend";return this.button?(this.button.setText(e).show(),this.parent.position(),this):(this.button=new i.Dashboard.Component.Button(this).setColor(t.color).setTitle("Show or hide the legend for this panel").setOnclick(function(){this.parent_panel.legend.layout.hidden=!this.parent_panel.legend.layout.hidden,this.parent_panel.legend.render(),this.update()}.bind(this)),this.update())}}),i.Legend=function(t){if(!t instanceof i.Panel)throw"Unable to create legend, parent must be a locuszoom panel";return this.parent=t,this.id=this.parent.getBaseId()+".legend",this.parent.layout.legend=i.Layouts.merge(this.parent.layout.legend||{},i.Legend.DefaultLayout),this.layout=this.parent.layout.legend,this.selector=null,this.background_rect=null,this.elements=[],this.hidden=!1,this.render()},i.Legend.DefaultLayout={orientation:"vertical",origin:{x:0,y:0},width:10,height:10,padding:5,label_size:12,hidden:!1},i.Legend.prototype.render=function(){this.selector||(this.selector=this.parent.svg.group.append("g").attr("id",this.parent.getBaseId()+".legend").attr("class","lz-legend")),this.background_rect||(this.background_rect=this.selector.append("rect").attr("width",100).attr("height",100).attr("class","lz-legend-background")),
this.elements_group||(this.elements_group=this.selector.append("g")),this.elements.forEach(function(t){t.remove()}),this.elements=[];var t=+this.layout.padding||1,e=t,i=t,a=0;this.parent.data_layer_ids_by_z_index.slice().reverse().forEach(function(n){Array.isArray(this.parent.data_layers[n].layout.legend)&&this.parent.data_layers[n].layout.legend.forEach(function(n){var s=this.elements_group.append("g").attr("transform","translate("+e+","+i+")"),o=+n.label_size||+this.layout.label_size||12,r=0,l=o/2+t/2;if(a=Math.max(a,o+t),"line"==n.shape){var h=+n.length||16,d=o/4+t/2;s.append("path").attr("class",n["class"]||"").attr("d","M0,"+d+"L"+h+","+d).style(n.style||{}),r=h+t}else if("rect"==n.shape){var u=+n.width||16,p=+n.height||u;s.append("rect").attr("class",n["class"]||"").attr("width",u).attr("height",p).attr("fill",n.color||{}).style(n.style||{}),r=u+t,a=Math.max(a,p+t)}else if(d3.svg.symbolTypes.indexOf(n.shape)!=-1){var c=+n.size||40,y=Math.ceil(Math.sqrt(c/Math.PI));s.append("path").attr("class",n["class"]||"").attr("d",d3.svg.symbol().size(c).type(n.shape)).attr("transform","translate("+y+","+(y+t/2)+")").attr("fill",n.color||{}).style(n.style||{}),r=2*y+t,l=Math.max(2*y+t/2,l),a=Math.max(a,2*y+t)}s.append("text").attr("text-anchor","left").attr("class","lz-label").attr("x",r).attr("y",l).style({"font-size":o}).text(n.label);var g=s.node().getBoundingClientRect();if("vertical"==this.layout.orientation)i+=g.height+t,a=0;else{var f=this.layout.origin.x+e+g.width;e>t&&f>this.parent.layout.width&&(i+=a,e=t,s.attr("transform","translate("+e+","+i+")")),e+=g.width+3*t}this.elements.push(s)}.bind(this))}.bind(this));var n=this.elements_group.node().getBoundingClientRect();return this.layout.width=n.width+2*this.layout.padding,this.layout.height=n.height+2*this.layout.padding,this.background_rect.attr("width",this.layout.width).attr("height",this.layout.height),this.selector.style({visibility:this.layout.hidden?"hidden":"visible"}),this.position()},i.Legend.prototype.position=function(){if(!this.selector)return this;var t=this.selector.node().getBoundingClientRect();isNaN(+this.layout.pad_from_bottom)||(this.layout.origin.y=this.parent.layout.height-t.height-+this.layout.pad_from_bottom),isNaN(+this.layout.pad_from_right)||(this.layout.origin.x=this.parent.layout.width-t.width-+this.layout.pad_from_right),this.selector.attr("transform","translate("+this.layout.origin.x+","+this.layout.origin.y+")")},i.Legend.prototype.hide=function(){this.layout.hidden=!0,this.render()},i.Legend.prototype.show=function(){this.layout.hidden=!1,this.render()},i.Data=i.Data||{},i.DataSources=function(){this.sources={}},i.DataSources.prototype.addSource=function(t,e){return console.warn("Warning: .addSource() is depricated. Use .add() instead"),this.add(t,e)},i.DataSources.prototype.add=function(t,e){return this.set(t,e)},i.DataSources.prototype.set=function(t,e){if(Array.isArray(e)){var a=i.KnownDataSources.create.apply(null,e);this.sources[t]=a}else null!==e?this.sources[t]=e:delete this.sources[t];return this},i.DataSources.prototype.getSource=function(t){return console.warn("Warning: .getSource() is depricated. Use .get() instead"),this.get(t)},i.DataSources.prototype.get=function(t){return this.sources[t]},i.DataSources.prototype.removeSource=function(t){return console.warn("Warning: .removeSource() is depricated. Use .remove() instead"),this.remove(t)},i.DataSources.prototype.remove=function(t){return this.set(t,null)},i.DataSources.prototype.fromJSON=function(t){"string"==typeof t&&(t=JSON.parse(t));var e=this;return Object.keys(t).forEach(function(i){e.set(i,t[i])}),e},i.DataSources.prototype.keys=function(){return Object.keys(this.sources)},i.DataSources.prototype.toJSON=function(){return this.sources},i.Data.Requester=function(t){function e(t){var e={},a=/^(?:([^:]+):)?([^:\|]*)(\|.+)*$/;return t.forEach(function(t){var n=a.exec(t),s=n[1]||"base",o=n[2],r=i.TransformationFunctions.get(n[3]);"undefined"==typeof e[s]&&(e[s]={outnames:[],fields:[],trans:[]}),e[s].outnames.push(t),e[s].fields.push(o),e[s].trans.push(r)}),e}this.getData=function(i,a){for(var n=e(a),s=Object.keys(n).map(function(e){if(!t.get(e))throw"Datasource for namespace "+e+" not found";return t.get(e).getData(i,n[e].fields,n[e].outnames,n[e].trans)}),o=Q.when({header:{},body:{}}),r=0;r<s.length;r++)o=o.then(s[r]);return o}},i.Data.Source=function(){this.enableCache=!0},i.Data.Source.prototype.parseInit=function(t){if("string"==typeof t?(this.url=t,this.params={}):(this.url=t.url,this.params=t.params||{}),!this.url)throw"Source not initialized with required URL"},i.Data.Source.prototype.getCacheKey=function(t,e,i){var a=this.getURL&&this.getURL(t,e,i);return a},i.Data.Source.prototype.fetchRequest=function(t,e,a){var n=this.getURL(t,e,a);return i.createCORSPromise("GET",n)},i.Data.Source.prototype.getRequest=function(t,e,i){var a,n=this.getCacheKey(t,e,i);return this.enableCache&&"undefined"!=typeof n&&n==this._cachedKey?a=Q.when(this._cachedResponse):(a=this.fetchRequest(t,e,i),this.enableCache&&(a=a.then(function(t){return this._cachedKey=n,this._cachedResponse=t}.bind(this)))),a},i.Data.Source.prototype.getData=function(t,e,i,a){if(this.preGetData){var n=this.preGetData(t,e,i,a);this.pre&&(t=n.state||t,e=n.fields||e,i=n.outnames||i,a=n.trans||a)}return function(n){return this.getRequest(t,n,e).then(function(t){return this.parseResponse(t,n,e,i,a)}.bind(this))}.bind(this)},i.Data.Source.prototype.parseResponse=function(t,e,i,a,n){var s="string"==typeof t?JSON.parse(t):t,o=this.parseData(s.data||s,i,a,n);return{header:e.header||{},body:o}},i.Data.Source.prototype.parseArraysToObjects=function(t,e,i,a){var n=[];e.forEach(function(e,a){if(!(e in t))throw"field "+e+" not found in response for "+i[a]});for(var s=t[Object.keys(t)[1]].length,o=0;o<s;o++){for(var r={},l=0;l<e.length;l++){var h=t[e[l]][o];a&&a[l]&&(h=a[l](h)),r[i[l]]=h}n.push(r)}return n},i.Data.Source.prototype.parseObjectsToObjects=function(t,e,i,a){for(var n=[],s=[],o=0;o<e.length;o++)s[o]=0;for(var r=0;r<t.length;r++){for(var l={},h=0;h<e.length;h++){var d=t[r][e[h]];"undefined"!=typeof d&&(s[h]=1),a&&a[h]&&(d=a[h](d)),l[i[h]]=d}n.push(l)}return s.forEach(function(t,a){if(!t)throw"field "+e[a]+" not found in response for "+i[a]}),n},i.Data.Source.prototype.parseData=function(t,e,i,a){return Array.isArray(t)?this.parseObjectsToObjects(t,e,i,a):this.parseArraysToObjects(t,e,i,a)},i.Data.Source.extend=function(t,e,a){return a?Array.isArray(a)?a=i.KnownDataSources.create.apply(null,a):"string"==typeof a?a=i.KnownDataSources.get(a).prototype:"function"==typeof a&&(a=a.prototype):a=new i.Data.Source,t=t||function(){},t.prototype=a,t.prototype.constructor=t,e&&(t.SOURCE_NAME=e,i.KnownDataSources.add(t)),t},i.Data.Source.prototype.toJSON=function(){return[Object.getPrototypeOf(this).constructor.SOURCE_NAME,{url:this.url,params:this.params}]},i.Data.AssociationSource=i.Data.Source.extend(function(t){this.parseInit(t)},"AssociationLZ"),i.Data.AssociationSource.prototype.preGetData=function(t,e,i,a){var n=this.params.id_field||"id";return[n,"position"].forEach(function(t){e.indexOf(t)==-1&&(e.unshift(t),i.unshift(t),a.unshift(null))}),{fields:e,outnames:i,trans:a}},i.Data.AssociationSource.prototype.getURL=function(t,e,i){var a=t.analysis||e.header.analysis||this.params.analysis||3;return this.url+"results/?filter=analysis in "+a+" and chromosome in  '"+t.chr+"' and position ge "+t.start+" and position le "+t.end},i.Data.LDSource=i.Data.Source.extend(function(t){this.parseInit(t)},"LDLZ"),i.Data.LDSource.prototype.preGetData=function(t,e){if(e.length>1&&(2!=e.length||e.indexOf("isrefvar")==-1))throw"LD does not know how to get all fields: "+e.join(", ")},i.Data.LDSource.prototype.findMergeFields=function(t){var e=function(t){return function(){for(var e=arguments,i=0;i<e.length;i++){var a=e[i],n=t.filter(function(t){return t.match(a)});if(1==n.length)return n[0]}return null}},i={id:this.params.id_field,position:this.params.position_field,pvalue:this.params.pvalue_field,_names_:null};if(t&&t.body&&t.body.length>0){var a=Object.keys(t.body[0]),n=e(a);i.id=i.id||n(/\bvariant\b/)||n(/\bid\b/),i.position=i.position||n(/\bposition\b/i,/\bpos\b/i),i.pvalue=i.pvalue||n(/\blog_pvalue\b/i)||n(/\bpvalue\|neglog10\b/i),i._names_=a}return i},i.Data.LDSource.prototype.findRequestedFields=function(t,e){for(var i={},a=0;a<t.length;a++)"isrefvar"==t[a]?(i.isrefvarin=t[a],i.isrefvarout=e&&e[a]):(i.ldin=t[a],i.ldout=e&&e[a]);return i},i.Data.LDSource.prototype.getURL=function(t,e,i){var a=function(t,e,i){e=e||"pvalue",i=i||1;for(var a=t[0][e],n=0,s=1;s<t.length;s++)t[s][e]*i>a&&(a=t[s][e]*i,n=s);return n},n=t.ldrefsource||e.header.ldrefsource||1,s=this.findRequestedFields(i),o=s.ldin;if("state"==o&&(o=t.ldrefvar||e.header.ldrefvar||"best"),"best"==o){if(!e.body)throw"No association data found to find best pvalue";var r=this.findMergeFields(e);if(!r.pvalue||!r.id)throw"Unable to find columns for both pvalue and id for merge: "+r._names_;o=e.body[a(e.body,r.pvalue)][r.id]}return e.header||(e.header={}),e.header.ldrefvar=o,this.url+"results/?filter=reference eq "+n+" and chromosome2 eq '"+t.chr+"' and position2 ge "+t.start+" and position2 le "+t.end+" and variant1 eq '"+o+"'&fields=chr,pos,rsquare"},i.Data.LDSource.prototype.parseResponse=function(t,e,i,a){var n=JSON.parse(t),s=this.findMergeFields(e),o=this.findRequestedFields(i,a);if(!s.position)throw"Unable to find position field for merge: "+s._names_;var r=function(t,e,i,a){for(var n=0,o=0;n<t.length&&o<e.position2.length;)t[n][s.position]==e.position2[o]?(t[n][i]=e[a][o],n++,o++):t[n][s.position]<e.position2[o]?n++:o++},l=function(t,e,i,a){for(var n=0;n<t.length;n++)t[n][i]&&t[n][i]===e?t[n][a]=1:t[n][a]=0};return r(e.body,n.data,o.ldout,"rsquare"),o.isrefvarin&&e.header.ldrefvar&&l(e.body,e.header.ldrefvar,s.id,o.isrefvarout),e},i.Data.GeneSource=i.Data.Source.extend(function(t){this.parseInit(t)},"GeneLZ"),i.Data.GeneSource.prototype.getURL=function(t,e,i){var a=t.source||e.header.source||this.params.source||2;return this.url+"?filter=source in "+a+" and chrom eq '"+t.chr+"' and start le "+t.end+" and end ge "+t.start},i.Data.GeneSource.prototype.parseResponse=function(t,e,i,a){var n=JSON.parse(t);return{header:e.header,body:n.data}},i.Data.GeneConstraintSource=i.Data.Source.extend(function(t){this.parseInit(t)},"GeneConstraintLZ"),i.Data.GeneConstraintSource.prototype.getURL=function(){return this.url},i.Data.GeneConstraintSource.prototype.getCacheKey=function(t,e,i){return this.url+JSON.stringify(t)},i.Data.GeneConstraintSource.prototype.fetchRequest=function(t,e,a){var n=[];e.body.forEach(function(t){var e=t.gene_id;e.indexOf(".")&&(e=e.substr(0,e.indexOf("."))),n.push(e)});var s=(this.getURL(t,e,a),"geneids="+encodeURIComponent(JSON.stringify(n))),o={"Content-Type":"application/x-www-form-urlencoded"};return i.createCORSPromise("POST",this.url,s,o)},i.Data.GeneConstraintSource.prototype.parseResponse=function(t,e,i,a){var n=JSON.parse(t),s=["bp","exp_lof","exp_mis","exp_syn","lof_z","mis_z","mu_lof","mu_mis","mu_syn","n_exons","n_lof","n_mis","n_syn","pLI","syn_z"];return e.body.forEach(function(t,i){var a=t.gene_id;a.indexOf(".")&&(a=a.substr(0,a.indexOf("."))),s.forEach(function(t){if("undefined"==typeof e.body[i][t])if(n[a]){var s=n[a][t];"number"==typeof s&&s.toString().indexOf(".")!=-1&&(s=parseFloat(s.toFixed(2))),e.body[i][t]=s}else e.body[i][t]=null})}),{header:e.header,body:e.body}},i.Data.RecombinationRateSource=i.Data.Source.extend(function(t){this.parseInit(t)},"RecombLZ"),i.Data.RecombinationRateSource.prototype.getURL=function(t,e,i){var a=t.recombsource||e.header.recombsource||this.params.source||15;return this.url+"?filter=id in "+a+" and chromosome eq '"+t.chr+"' and position le "+t.end+" and position ge "+t.start},i.Data.IntervalSource=i.Data.Source.extend(function(t){this.parseInit(t)},"IntervalLZ"),i.Data.IntervalSource.prototype.getURL=function(t,e,i){var a=t.bedtracksource||e.header.bedtracksource||this.params.source||16;return this.url+"?filter=id in "+a+" and chromosome eq '"+t.chr+"' and start le "+t.end+" and end ge "+t.start},i.Data.StaticSource=i.Data.Source.extend(function(t){this._data=t},"StaticJSON"),i.Data.StaticSource.prototype.getRequest=function(t,e,i){return Q.fcall(function(){return this._data}.bind(this))},i.Data.StaticSource.prototype.toJSON=function(){return[Object.getPrototypeOf(this).constructor.SOURCE_NAME,this._data]},i.Plot=function(t,e,a){return this.initialized=!1,this.id=t,this.svg=null,this.panels={},this.panel_ids_by_y_index=[],this.applyPanelYIndexesToPanelLayouts=function(){this.panel_ids_by_y_index.forEach(function(t,e){this.panels[t].layout.y_index=e}.bind(this))},this.getBaseId=function(){return this.id},this.remap_promises=[],"undefined"==typeof a?this.layout=i.Layouts.merge({},i.Layouts.get("plot","standard_association")):this.layout=a,i.Layouts.merge(this.layout,i.Plot.DefaultLayout),this.state=this.layout.state,this.lzd=new i.Data.Requester(e),this.window_onresize=null,this.event_hooks={layout_changed:[],data_requested:[],data_rendered:[],element_clicked:[]},this.on=function(t,e){if(!Array.isArray(this.event_hooks[t]))throw"Unable to register event hook, invalid event: "+t.toString();if("function"!=typeof e)throw"Unable to register event hook, invalid hook function passed";return this.event_hooks[t].push(e),this},this.emit=function(t,e){if(!Array.isArray(this.event_hooks[t]))throw"LocusZoom attempted to throw an invalid event: "+t.toString();return e=e||this,this.event_hooks[t].forEach(function(t){t.call(e)}),this},this.getPageOrigin=function(){for(var t=this.svg.node().getBoundingClientRect(),e=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,a=this.svg.node();null!=a.parentNode;)if(a=a.parentNode,a!=document&&"static"!=d3.select(a).style("position")){e=-1*a.getBoundingClientRect().left,i=-1*a.getBoundingClientRect().top;break}return{x:e+t.left,y:i+t.top,width:t.width,height:t.height}},this.initializeLayout(),this},i.Plot.DefaultLayout={state:{},width:1,height:1,min_width:1,min_height:1,responsive_resize:!1,aspect_ratio:1,panels:[],dashboard:{components:[]},panel_boundaries:!0},i.Plot.prototype.sumProportional=function(t){if("height"!=t&&"width"!=t)throw"Bad dimension value passed to LocusZoom.Plot.prototype.sumProportional";var e=0;for(var i in this.panels)this.panels[i].layout["proportional_"+t]||(this.panels[i].layout["proportional_"+t]=1/Object.keys(this.panels).length),e+=this.panels[i].layout["proportional_"+t];return e},i.Plot.prototype.rescaleSVG=function(){var t=this.svg.node().parentNode.getBoundingClientRect();return this.setDimensions(t.width,t.height),this},i.Plot.prototype.initializeLayout=function(){if(isNaN(this.layout.width)||this.layout.width<=0)throw"Plot layout parameter `width` must be a positive number";if(isNaN(this.layout.height)||this.layout.height<=0)throw"Plot layout parameter `width` must be a positive number";if(isNaN(this.layout.aspect_ratio)||this.layout.aspect_ratio<=0)throw"Plot layout parameter `aspect_ratio` must be a positive number";return this.layout.responsive_resize&&(this.window_onresize=d3.select(window).on("resize.lz-"+this.id,function(){this.rescaleSVG()}.bind(this)),d3.select(window).on("load.lz-"+this.id,function(){this.setDimensions()}.bind(this))),this.layout.panels.forEach(function(t){this.addPanel(t)}.bind(this)),this},i.Plot.prototype.setDimensions=function(t,e){var i,a=0,n=0;for(i in this.panels)a=Math.max(a,this.panels[i].layout.min_width),parseFloat(this.panels[i].layout.min_height)>0&&parseFloat(this.panels[i].layout.proportional_height)>0&&(n=Math.max(n,this.panels[i].layout.min_height/this.panels[i].layout.proportional_height));if(this.layout.min_width=Math.max(a,1),this.layout.min_height=Math.max(n,1),!isNaN(t)&&t>=0&&!isNaN(e)&&e>=0){this.layout.width=Math.max(Math.round(+t),this.layout.min_width),this.layout.height=Math.max(Math.round(+e),this.layout.min_height),this.layout.aspect_ratio=this.layout.width/this.layout.height,this.layout.responsive_resize&&(this.svg&&(this.layout.width=Math.max(this.svg.node().parentNode.getBoundingClientRect().width,this.layout.min_width)),this.layout.height=this.layout.width/this.layout.aspect_ratio,this.layout.height<this.layout.min_height&&(this.layout.height=this.layout.min_height,this.layout.width=this.layout.height*this.layout.aspect_ratio));var s=0;this.panel_ids_by_y_index.forEach(function(t){var e=this.layout.width,i=this.panels[t].layout.proportional_height*this.layout.height;this.panels[t].setDimensions(e,i),this.panels[t].setOrigin(0,s),this.panels[t].layout.proportional_origin.x=0,this.panels[t].layout.proportional_origin.y=s/this.layout.height,s+=i,this.panels[t].dashboard.update()}.bind(this))}else if(Object.keys(this.panels).length){this.layout.width=0,this.layout.height=0;for(i in this.panels)this.layout.width=Math.max(this.panels[i].layout.width,this.layout.width),this.layout.height+=this.panels[i].layout.height;this.layout.width=Math.max(this.layout.width,this.layout.min_width),this.layout.height=Math.max(this.layout.height,this.layout.min_height)}return this.layout.aspect_ratio=this.layout.width/this.layout.height,null!=this.svg&&(this.layout.responsive_resize?this.svg.attr("viewBox","0 0 "+this.layout.width+" "+this.layout.height).attr("preserveAspectRatio","xMinYMin meet"):this.svg.attr("width",this.layout.width).attr("height",this.layout.height)),this.initialized&&(this.panel_boundaries.position(),this.dashboard.update(),this.curtain.update(),this.loader.update()),this.emit("layout_changed")},i.Plot.prototype.addPanel=function(t){if("object"!=typeof t)throw"Invalid panel layout passed to LocusZoom.Plot.prototype.addPanel()";var e=new i.Panel(t,this);if(this.panels[e.id]=e,null!=e.layout.y_index&&!isNaN(e.layout.y_index)&&this.panel_ids_by_y_index.length>0)e.layout.y_index<0&&(e.layout.y_index=Math.max(this.panel_ids_by_y_index.length+e.layout.y_index,0)),this.panel_ids_by_y_index.splice(e.layout.y_index,0,e.id),this.applyPanelYIndexesToPanelLayouts();else{var a=this.panel_ids_by_y_index.push(e.id);this.panels[e.id].layout.y_index=a-1}var n=null;return this.layout.panels.forEach(function(t,i){t.id==e.id&&(n=i)}),null==n&&(n=this.layout.panels.push(this.panels[e.id].layout)-1),this.panels[e.id].layout_idx=n,this.initialized&&(this.positionPanels(),this.panels[e.id].initialize(),this.panels[e.id].reMap(),this.setDimensions(this.layout.width,this.layout.height)),this.panels[e.id]},i.Plot.prototype.removePanel=function(t){if(!this.panels[t])throw"Unable to remove panel, ID not found: "+t;return this.panel_boundaries.hide(),this.panels[t].data_layer_ids_by_z_index.forEach(function(e){this.panels[t].data_layers[e].destroyAllTooltips(),delete this.layout.state[t+"."+e]}.bind(this)),this.panels[t].loader.hide(),this.panels[t].dashboard.destroy(!0),this.panels[t].curtain.hide(),this.panels[t].svg.container&&this.panels[t].svg.container.remove(),this.layout.panels.splice(this.panels[t].layout_idx,1),delete this.panels[t],delete this.layout.state[t],this.layout.panels.forEach(function(t,e){this.panels[t.id].layout_idx=e}.bind(this)),this.panel_ids_by_y_index.splice(this.panel_ids_by_y_index.indexOf(t),1),this.initialized&&(this.positionPanels(),this.setDimensions(this.layout.width,this.layout.height)),this},i.Plot.prototype.positionPanels=function(){var t,e={left:0,right:0};for(t in this.panels)null==this.panels[t].layout.proportional_height&&(this.panels[t].layout.proportional_height=this.panels[t].layout.height/this.layout.height),null==this.panels[t].layout.proportional_width&&(this.panels[t].layout.proportional_width=1),this.panels[t].layout.interaction.x_linked&&(e.left=Math.max(e.left,this.panels[t].layout.margin.left),e.right=Math.max(e.right,this.panels[t].layout.margin.right));var i=this.sumProportional("height");if(!i)return this;var a=1/i;for(t in this.panels)this.panels[t].layout.proportional_height*=a;var n=0;this.panel_ids_by_y_index.forEach(function(t){if(this.panels[t].setOrigin(0,n),this.panels[t].layout.proportional_origin.x=0,n+=this.panels[t].layout.height,this.panels[t].layout.interaction.x_linked){var i=Math.max(e.left-this.panels[t].layout.margin.left,0)+Math.max(e.right-this.panels[t].layout.margin.right,0);this.panels[t].layout.width+=i,this.panels[t].layout.margin.left=e.left,this.panels[t].layout.margin.right=e.right,this.panels[t].layout.cliparea.origin.x=e.left}}.bind(this));var s=n;return this.panel_ids_by_y_index.forEach(function(t){this.panels[t].layout.proportional_origin.y=this.panels[t].layout.origin.y/s}.bind(this)),this.setDimensions(),this.panel_ids_by_y_index.forEach(function(t){this.panels[t].setDimensions(this.layout.width*this.panels[t].layout.proportional_width,this.layout.height*this.panels[t].layout.proportional_height)}.bind(this)),this},i.Plot.prototype.initialize=function(){var t=this.svg.append("g").attr("class","lz-mouse_guide").attr("id",this.id+".mouse_guide"),e=t.append("rect").attr("class","lz-mouse_guide-vertical").attr("x",-1),a=t.append("rect").attr("class","lz-mouse_guide-horizontal").attr("y",-1);this.mouse_guide={svg:t,vertical:e,horizontal:a},this.curtain={showing:!1,selector:null,content_selector:null,show:function(t,e){return this.curtain.showing||(this.curtain.selector=d3.select(this.svg.node().parentNode).insert("div").attr("class","lz-curtain").attr("id",this.id+".curtain"),this.curtain.content_selector=this.curtain.selector.append("div").attr("class","lz-curtain-content"),this.curtain.selector.append("div").attr("class","lz-curtain-dismiss").html("Dismiss").on("click",function(){this.curtain.hide()}.bind(this)),this.curtain.showing=!0),this.curtain.update(t,e)}.bind(this),update:function(t,e){if(!this.curtain.showing)return this.curtain;"object"==typeof e&&null!=e&&this.curtain.selector.style(e);var i=this.getPageOrigin();return this.curtain.selector.style({top:i.y+"px",left:i.x+"px",width:this.layout.width+"px",height:this.layout.height+"px"}),this.curtain.content_selector.style({"max-width":this.layout.width-40+"px","max-height":this.layout.height-40+"px"}),"string"==typeof t&&this.curtain.content_selector.html(t),this.curtain}.bind(this),hide:function(){return this.curtain.showing?(this.curtain.selector.remove(),this.curtain.selector=null,this.curtain.content_selector=null,this.curtain.showing=!1,this.curtain):this.curtain}.bind(this)},this.loader={showing:!1,selector:null,content_selector:null,progress_selector:null,cancel_selector:null,show:function(t){return this.loader.showing||(this.loader.selector=d3.select(this.svg.node().parentNode).insert("div").attr("class","lz-loader").attr("id",this.id+".loader"),this.loader.content_selector=this.loader.selector.append("div").attr("class","lz-loader-content"),this.loader.progress_selector=this.loader.selector.append("div").attr("class","lz-loader-progress-container").append("div").attr("class","lz-loader-progress"),this.loader.showing=!0,"undefined"==typeof t&&(t="Loading...")),this.loader.update(t)}.bind(this),update:function(t,e){if(!this.loader.showing)return this.loader;"string"==typeof t&&this.loader.content_selector.html(t);var i=6,a=this.getPageOrigin(),n=this.loader.selector.node().getBoundingClientRect();return this.loader.selector.style({top:a.y+this.layout.height-n.height-i+"px",left:a.x+i+"px"}),"number"==typeof e&&this.loader.progress_selector.style({width:Math.min(Math.max(e,1),100)+"%"}),this.loader}.bind(this),animate:function(){return this.loader.progress_selector.classed("lz-loader-progress-animated",!0),this.loader}.bind(this),setPercentCompleted:function(t){return this.loader.progress_selector.classed("lz-loader-progress-animated",!1),this.loader.update(null,t)}.bind(this),hide:function(){return this.loader.showing?(this.loader.selector.remove(),this.loader.selector=null,this.loader.content_selector=null,this.loader.progress_selector=null,this.loader.cancel_selector=null,this.loader.showing=!1,this.loader):this.loader}.bind(this)},this.panel_boundaries={parent:this,hide_timeout:null,showing:!1,dragging:!1,selectors:[],corner_selector:null,show:function(){if(!this.showing&&!this.parent.curtain.showing){this.showing=!0,this.parent.panel_ids_by_y_index.forEach(function(t,e){var i=d3.select(this.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip").attr("class","lz-panel-boundary").attr("title","Resize panel");i.append("span");var a=d3.behavior.drag();a.on("dragstart",function(){this.dragging=!0}.bind(this)),a.on("dragend",function(){this.dragging=!1}.bind(this)),a.on("drag",function(){var t=this.parent.panels[this.parent.panel_ids_by_y_index[e]],i=t.layout.height;t.setDimensions(t.layout.width,t.layout.height+d3.event.dy);var a=t.layout.height-i,n=this.parent.layout.height+a;this.parent.panel_ids_by_y_index.forEach(function(t,i){var s=this.parent.panels[this.parent.panel_ids_by_y_index[i]];s.layout.proportional_height=s.layout.height/n,i>e&&(s.setOrigin(s.layout.origin.x,s.layout.origin.y+a),s.dashboard.position())}.bind(this)),this.parent.positionPanels(),this.position()}.bind(this)),i.call(a),this.parent.panel_boundaries.selectors.push(i)}.bind(this));var t=d3.select(this.parent.svg.node().parentNode).insert("div",".lz-data_layer-tooltip").attr("class","lz-panel-corner-boundary").attr("title","Resize plot");t.append("span").attr("class","lz-panel-corner-boundary-outer"),t.append("span").attr("class","lz-panel-corner-boundary-inner");var e=d3.behavior.drag();e.on("dragstart",function(){this.dragging=!0}.bind(this)),e.on("dragend",function(){this.dragging=!1}.bind(this)),e.on("drag",function(){this.setDimensions(this.layout.width+d3.event.dx,this.layout.height+d3.event.dy)}.bind(this.parent)),t.call(e),this.parent.panel_boundaries.corner_selector=t}return this.position()},position:function(){if(!this.showing)return this;var t=this.parent.getPageOrigin();this.selectors.forEach(function(e,i){var a=this.parent.panels[this.parent.panel_ids_by_y_index[i]].getPageOrigin(),n=t.x,s=a.y+this.parent.panels[this.parent.panel_ids_by_y_index[i]].layout.height-12,o=this.parent.layout.width-1;e.style({top:s+"px",left:n+"px",width:o+"px"}),e.select("span").style({width:o+"px"})}.bind(this));var e=10,i=16;return this.corner_selector.style({top:t.y+this.parent.layout.height-e-i+"px",left:t.x+this.parent.layout.width-e-i+"px"}),this},hide:function(){return this.showing?(this.showing=!1,this.selectors.forEach(function(t){t.remove()}),this.selectors=[],this.corner_selector.remove(),this.corner_selector=null,this):this}},this.layout.panel_boundaries&&(d3.select(this.svg.node().parentNode).on("mouseover."+this.id+".panel_boundaries",function(){clearTimeout(this.panel_boundaries.hide_timeout),this.panel_boundaries.show()}.bind(this)),d3.select(this.svg.node().parentNode).on("mouseout."+this.id+".panel_boundaries",function(){this.panel_boundaries.hide_timeout=setTimeout(function(){this.panel_boundaries.hide()}.bind(this),300)}.bind(this))),this.dashboard=new i.Dashboard(this).show();for(var n in this.panels)this.panels[n].initialize();return this.svg.on("mouseout",function(){this.mouse_guide.vertical.attr("x",-1),this.mouse_guide.horizontal.attr("y",-1)}.bind(this)),this.svg.on("mousemove",function(){var t=d3.mouse(this.svg.node());this.mouse_guide.vertical.attr("x",t[0]),this.mouse_guide.horizontal.attr("y",t[1]),this.dashboard.update()}.bind(this)),this.initialized=!0,this.setDimensions(this.layout.width,this.layout.height),this},i.Plot.prototype.mapTo=function(t,e,i){return console.warn("Warning: use of LocusZoom.Plot.mapTo() is deprecated. Use LocusZoom.Plot.applyState() instead."),this.applyState({chr:t,start:e,end:i})},i.Plot.prototype.refresh=function(){return this.applyState()},i.Plot.prototype.applyState=function(t){if(t=t||{},"object"!=typeof t)throw"LocusZoom.applyState only accepts an object; "+typeof t+" given";var e=JSON.parse(JSON.stringify(this.state));for(var a in t)e[a]=t[a];e=i.validateState(e,this.layout);for(a in e)this.state[a]=e[a];this.emit("data_requested"),this.remap_promises=[],this.loading_data=!0;for(var n in this.panels)this.remap_promises.push(this.panels[n].reMap());return Q.all(this.remap_promises)["catch"](function(t){console.log(t),this.curtain.drop(t),this.loading_data=!1}.bind(this)).done(function(){this.dashboard.update(),this.panel_ids_by_y_index.forEach(function(t){var e=this.panels[t];e.dashboard.update(),e.data_layer_ids_by_z_index.forEach(function(e){var i=this.data_layers[e],a=t+"."+e;for(var n in this.state[a])this.state[a].hasOwnProperty(n)&&Array.isArray(this.state[a][n])&&this.state[a][n].forEach(function(t){try{this.setElementStatus(n,this.getElementById(t),!0)}catch(e){console.error("Unable to apply state: "+a+", "+n)}}.bind(i))}.bind(e))}.bind(this)),this.emit("layout_changed"),this.emit("data_rendered"),this.loading_data=!1}.bind(this))},i.Panel=function(t,e){if("object"!=typeof t)throw"Unable to create panel, invalid layout";if(this.parent=e||null,"string"==typeof t.id&&t.id.length){if(this.parent&&"undefined"!=typeof this.parent.panels[t.id])throw"Cannot create panel with id ["+t.id+"]; panel with that id already exists"}else if(this.parent){var a=null,n=function(){a="p"+Math.floor(Math.random()*Math.pow(10,8)),null!=a&&"undefined"==typeof this.parent.panels[a]||(a=n())}.bind(this);t.id=a}else t.id="p"+Math.floor(Math.random()*Math.pow(10,8));return this.id=t.id,this.initialized=!1,this.layout_idx=null,this.svg={},this.layout=i.Layouts.merge(t||{},i.Panel.DefaultLayout),this.parent?(this.state=this.parent.state,this.state_id=this.id,this.state[this.state_id]=this.state[this.state_id]||{}):(this.state=null,this.state_id=null),this.data_layers={},this.data_layer_ids_by_z_index=[],this.data_promises=[],this.x_scale=null,this.y1_scale=null,this.y2_scale=null,this.x_extent=null,this.y1_extent=null,this.y2_extent=null,this.x_ticks=[],this.y1_ticks=[],this.y2_ticks=[],this.zoom_timeout=null,this.getBaseId=function(){return this.parent.id+"."+this.id},this.canInteract=function(){return!(this.interactions.dragging||this.interactions.zooming||this.parent.loading_data)},this.event_hooks={layout_changed:[],data_requested:[],data_rendered:[],element_clicked:[]},this.on=function(t,e){if(!Array.isArray(this.event_hooks[t]))throw"Unable to register event hook, invalid event: "+t.toString();if("function"!=typeof e)throw"Unable to register event hook, invalid hook function passed";return this.event_hooks[t].push(e),this},this.emit=function(t,e){if(!Array.isArray(this.event_hooks[t]))throw"LocusZoom attempted to throw an invalid event: "+t.toString();return e=e||this,this.event_hooks[t].forEach(function(t){t.call(e)}),this},this.getPageOrigin=function(){var t=this.parent.getPageOrigin();return{x:t.x+this.layout.origin.x,y:t.y+this.layout.origin.y}},this.interactions={},this.initializeLayout(),this},i.Panel.DefaultLayout={title:null,description:null,y_index:null,width:0,height:0,origin:{x:0,y:null},min_width:1,min_height:1,proportional_width:null,proportional_height:null,proportional_origin:{x:0,y:null},margin:{top:0,right:0,bottom:0,left:0},background_click:"clear_selections",dashboard:{components:[]},cliparea:{height:0,width:0,origin:{x:0,y:0}},axes:{x:{},y1:{},y2:{}},legend:null,interaction:{drag_background_to_pan:!1,drag_x_ticks_to_scale:!1,drag_y1_ticks_to_scale:!1,drag_y2_ticks_to_scale:!1,scroll_to_zoom:!1,x_linked:!1,y1_linked:!1,y2_linked:!1},data_layers:[]},i.Panel.prototype.initializeLayout=function(){if(0==this.layout.width&&null==this.layout.proportional_width&&(this.layout.proportional_width=1),0==this.layout.height&&null==this.layout.proportional_height){var t=Object.keys(this.parent.panels).length;t>0?this.layout.proportional_height=1/t:this.layout.proportional_height=1}return this.setDimensions(),this.setOrigin(),this.setMargin(),this.x_range=[0,this.layout.cliparea.width],this.y1_range=[this.layout.cliparea.height,0],this.y2_range=[this.layout.cliparea.height,0],["x","y1","y2"].forEach(function(t){Object.keys(this.layout.axes[t]).length&&this.layout.axes[t].render!==!1?(this.layout.axes[t].render=!0,
this.layout.axes[t].label=this.layout.axes[t].label||null,this.layout.axes[t].label_function=this.layout.axes[t].label_function||null):this.layout.axes[t].render=!1}.bind(this)),this.layout.data_layers.forEach(function(t){this.addDataLayer(t)}.bind(this)),this},i.Panel.prototype.setDimensions=function(t,e){return"undefined"!=typeof t&&"undefined"!=typeof e?!isNaN(t)&&t>=0&&!isNaN(e)&&e>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width),this.layout.height=Math.max(Math.round(+e),this.layout.min_height)):(null!=this.layout.proportional_width&&(this.layout.width=Math.max(this.layout.proportional_width*this.parent.layout.width,this.layout.min_width)),null!=this.layout.proportional_height&&(this.layout.height=Math.max(this.layout.proportional_height*this.parent.layout.height,this.layout.min_height))),this.layout.cliparea.width=Math.max(this.layout.width-(this.layout.margin.left+this.layout.margin.right),0),this.layout.cliparea.height=Math.max(this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),0),this.svg.clipRect&&this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.initialized&&(this.render(),this.curtain.update(),this.loader.update(),this.dashboard.update(),this.legend&&this.legend.position()),this},i.Panel.prototype.setOrigin=function(t,e){return!isNaN(t)&&t>=0&&(this.layout.origin.x=Math.max(Math.round(+t),0)),!isNaN(e)&&e>=0&&(this.layout.origin.y=Math.max(Math.round(+e),0)),this.initialized&&this.render(),this},i.Panel.prototype.setMargin=function(t,e,i,a){var n;return!isNaN(t)&&t>=0&&(this.layout.margin.top=Math.max(Math.round(+t),0)),!isNaN(e)&&e>=0&&(this.layout.margin.right=Math.max(Math.round(+e),0)),!isNaN(i)&&i>=0&&(this.layout.margin.bottom=Math.max(Math.round(+i),0)),!isNaN(a)&&a>=0&&(this.layout.margin.left=Math.max(Math.round(+a),0)),this.layout.margin.top+this.layout.margin.bottom>this.layout.height&&(n=Math.floor((this.layout.margin.top+this.layout.margin.bottom-this.layout.height)/2),this.layout.margin.top-=n,this.layout.margin.bottom-=n),this.layout.margin.left+this.layout.margin.right>this.layout.width&&(n=Math.floor((this.layout.margin.left+this.layout.margin.right-this.layout.width)/2),this.layout.margin.left-=n,this.layout.margin.right-=n),["top","right","bottom","left"].forEach(function(t){this.layout.margin[t]=Math.max(this.layout.margin[t],0)}.bind(this)),this.layout.cliparea.width=Math.max(this.layout.width-(this.layout.margin.left+this.layout.margin.right),0),this.layout.cliparea.height=Math.max(this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),0),this.layout.cliparea.origin.x=this.layout.margin.left,this.layout.cliparea.origin.y=this.layout.margin.top,this.initialized&&this.render(),this},i.Panel.prototype.initialize=function(){this.svg.container=this.parent.svg.append("g").attr("id",this.getBaseId()+".panel_container").attr("transform","translate("+(this.layout.origin.x||0)+","+(this.layout.origin.y||0)+")");var t=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip");if(this.svg.clipRect=t.append("rect").attr("width",this.layout.width).attr("height",this.layout.height),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".panel").attr("clip-path","url(#"+this.getBaseId()+".clip)"),this.curtain={showing:!1,selector:null,content_selector:null,show:function(t,e){return this.curtain.showing||(this.curtain.selector=d3.select(this.parent.svg.node().parentNode).insert("div").attr("class","lz-curtain").attr("id",this.id+".curtain"),this.curtain.content_selector=this.curtain.selector.append("div").attr("class","lz-curtain-content"),this.curtain.selector.append("div").attr("class","lz-curtain-dismiss").html("Dismiss").on("click",function(){this.curtain.hide()}.bind(this)),this.curtain.showing=!0),this.curtain.update(t,e)}.bind(this),update:function(t,e){if(!this.curtain.showing)return this.curtain;"object"==typeof e&&this.curtain.selector.style(e);var i=this.getPageOrigin();return this.curtain.selector.style({top:i.y+"px",left:i.x+"px",width:this.layout.width+"px",height:this.layout.height+"px"}),this.curtain.content_selector.style({"max-width":this.layout.width-40+"px","max-height":this.layout.height-40+"px"}),"string"==typeof t&&this.curtain.content_selector.html(t),this.curtain}.bind(this),hide:function(){return this.curtain.showing?(this.curtain.selector.remove(),this.curtain.selector=null,this.curtain.content_selector=null,this.curtain.showing=!1,this.curtain):this.curtain}.bind(this)},this.loader={showing:!1,selector:null,content_selector:null,progress_selector:null,cancel_selector:null,show:function(t){return this.loader.showing||(this.loader.selector=d3.select(this.parent.svg.node().parentNode).insert("div").attr("class","lz-loader").attr("id",this.id+".loader"),this.loader.content_selector=this.loader.selector.append("div").attr("class","lz-loader-content"),this.loader.progress_selector=this.loader.selector.append("div").attr("class","lz-loader-progress-container").append("div").attr("class","lz-loader-progress"),this.loader.showing=!0,"undefined"==typeof t&&(t="Loading...")),this.loader.update(t)}.bind(this),update:function(t,e){if(!this.loader.showing)return this.loader;"string"==typeof t&&this.loader.content_selector.html(t);var i=6,a=this.getPageOrigin(),n=this.loader.selector.node().getBoundingClientRect();return this.loader.selector.style({top:a.y+this.layout.height-n.height-i+"px",left:a.x+i+"px"}),"number"==typeof e&&this.loader.progress_selector.style({width:Math.min(Math.max(e,1),100)+"%"}),this.loader}.bind(this),animate:function(){return this.loader.progress_selector.classed("lz-loader-progress-animated",!0),this.loader}.bind(this),setPercentCompleted:function(t){return this.loader.progress_selector.classed("lz-loader-progress-animated",!1),this.loader.update(null,t)}.bind(this),hide:function(){return this.loader.showing?(this.loader.selector.remove(),this.loader.selector=null,this.loader.content_selector=null,this.loader.progress_selector=null,this.loader.cancel_selector=null,this.loader.showing=!1,this.loader):this.loader}.bind(this)},this.dashboard=new i.Dashboard(this),this.inner_border=this.svg.group.append("rect").attr("class","lz-panel-background").on("click",function(){"clear_selections"==this.layout.background_click&&this.clearSelections()}.bind(this)),this.layout.title){var e=10,a=22;"string"==typeof this.layout.title&&(this.layout.title={text:this.layout.title,x:e,y:a}),this.svg.group.append("text").attr("class","lz-panel-title").attr("x",parseFloat(this.layout.title.x)||e).attr("y",parseFloat(this.layout.title.y)||a).text(this.layout.title.text)}this.svg.x_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".x_axis").attr("class","lz-x lz-axis"),this.layout.axes.x.render&&(this.svg.x_axis_label=this.svg.x_axis.append("text").attr("class","lz-x lz-axis lz-label").attr("text-anchor","middle")),this.svg.y1_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".y1_axis").attr("class","lz-y lz-y1 lz-axis"),this.layout.axes.y1.render&&(this.svg.y1_axis_label=this.svg.y1_axis.append("text").attr("class","lz-y1 lz-axis lz-label").attr("text-anchor","middle")),this.svg.y2_axis=this.svg.group.append("g").attr("id",this.getBaseId()+".y2_axis").attr("class","lz-y lz-y2 lz-axis"),this.layout.axes.y2.render&&(this.svg.y2_axis_label=this.svg.y2_axis.append("text").attr("class","lz-y2 lz-axis lz-label").attr("text-anchor","middle")),this.data_layer_ids_by_z_index.forEach(function(t){this.data_layers[t].initialize()}.bind(this)),this.legend=null,this.layout.legend&&(this.legend=new i.Legend(this));var n="."+this.parent.id+"."+this.id+".interaction.drag";if(this.layout.interaction.drag_background_to_pan){var s=this,o=function(){s.toggleDragging("background")};this.svg.container.select(".lz-panel-background").on("mousedown"+n+".background",o).on("touchstart"+n+".background",o)}if(this.layout.interaction.drag_background_to_pan||this.layout.interaction.drag_x_ticks_to_scale||this.layout.interaction.drag_y1_ticks_to_scale||this.layout.interaction.drag_y2_ticks_to_scale){var r=function(){this.toggleDragging()}.bind(this),l=function(){if(this.interactions.dragging&&this.interactions.dragging.panel_id==this.id){d3.event&&d3.event.preventDefault();var t=d3.mouse(this.svg.container.node());this.interactions.dragging.dragged_x=t[0]-this.interactions.dragging.start_x,this.interactions.dragging.dragged_y=t[1]-this.interactions.dragging.start_y,this.render()}}.bind(this);this.parent.svg.on("mouseup"+n,r).on("touchend"+n,r).on("mousemove"+n,l).on("touchmove"+n,l)}return this},i.Panel.prototype.moveUp=function(){return this.parent.panel_ids_by_y_index[this.layout.y_index-1]&&(this.parent.panel_ids_by_y_index[this.layout.y_index]=this.parent.panel_ids_by_y_index[this.layout.y_index-1],this.parent.panel_ids_by_y_index[this.layout.y_index-1]=this.id,this.parent.applyPanelYIndexesToPanelLayouts(),this.parent.positionPanels()),this},i.Panel.prototype.moveDown=function(){return this.parent.panel_ids_by_y_index[this.layout.y_index+1]&&(this.parent.panel_ids_by_y_index[this.layout.y_index]=this.parent.panel_ids_by_y_index[this.layout.y_index+1],this.parent.panel_ids_by_y_index[this.layout.y_index+1]=this.id,this.parent.applyPanelYIndexesToPanelLayouts(),this.parent.positionPanels()),this},i.Panel.prototype.addDataLayer=function(t){if("object"!=typeof t||"string"!=typeof t.id||!t.id.length)throw"Invalid data layer layout passed to LocusZoom.Panel.prototype.addDataLayer()";if("undefined"!=typeof this.data_layers[t.id])throw"Cannot create data_layer with id ["+t.id+"]; data layer with that id already exists in the panel";if("string"!=typeof t.type)throw"Invalid data layer type in layout passed to LocusZoom.Panel.prototype.addDataLayer()";"object"!=typeof t.y_axis||"undefined"!=typeof t.y_axis.axis&&[1,2].indexOf(t.y_axis.axis)!=-1||(t.y_axis.axis=1);var e=i.DataLayers.get(t.type,t,this);if(this.data_layers[e.id]=e,null!=e.layout.z_index&&!isNaN(e.layout.z_index)&&this.data_layer_ids_by_z_index.length>0)e.layout.z_index<0&&(e.layout.z_index=Math.max(this.data_layer_ids_by_z_index.length+e.layout.z_index,0)),this.data_layer_ids_by_z_index.splice(e.layout.z_index,0,e.id),this.data_layer_ids_by_z_index.forEach(function(t,e){this.data_layers[t].layout.z_index=e}.bind(this));else{var a=this.data_layer_ids_by_z_index.push(e.id);this.data_layers[e.id].layout.z_index=a-1}var n=null;return this.layout.data_layers.forEach(function(t,i){t.id==e.id&&(n=i)}),null==n&&(n=this.layout.data_layers.push(this.data_layers[e.id].layout)-1),this.data_layers[e.id].layout_idx=n,this.data_layers[e.id]},i.Panel.prototype.clearSelections=function(){return this.data_layer_ids_by_z_index.forEach(function(t){this.data_layers[t].setAllElementStatus("selected",!1)}.bind(this)),this},i.Panel.prototype.reMap=function(){this.emit("data_requested"),this.data_promises=[];for(var t in this.data_layers)try{this.data_promises.push(this.data_layers[t].reMap())}catch(e){console.warn(e),this.curtain.show(e)}return Q.all(this.data_promises).then(function(){this.initialized=!0,this.render(),this.emit("layout_changed"),this.parent.emit("layout_changed"),this.emit("data_rendered")}.bind(this))["catch"](function(t){console.warn(t),this.curtain.show(t)}.bind(this))},i.Panel.prototype.generateExtents=function(){["x","y1","y2"].forEach(function(t){this[t+"_extent"]=null}.bind(this));for(var t in this.data_layers){var e=this.data_layers[t];if(e.layout.x_axis&&!e.layout.x_axis.decoupled&&(this.x_extent=d3.extent((this.x_extent||[]).concat(e.getAxisExtent("x")))),e.layout.y_axis&&!e.layout.y_axis.decoupled){var i="y"+e.layout.y_axis.axis;this[i+"_extent"]=d3.extent((this[i+"_extent"]||[]).concat(e.getAxisExtent("y")))}}return this.layout.axes.x&&"state"==this.layout.axes.x.extent&&(this.x_extent=[this.state.start,this.state.end]),this},i.Panel.prototype.render=function(t){"undefined"==typeof t&&(t=!1),this.svg.container.attr("transform","translate("+this.layout.origin.x+","+this.layout.origin.y+")"),this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),this.inner_border.attr("x",this.layout.margin.left).attr("y",this.layout.margin.top).attr("width",this.layout.width-(this.layout.margin.left+this.layout.margin.right)).attr("height",this.layout.height-(this.layout.margin.top+this.layout.margin.bottom)),this.layout.inner_border&&this.inner_border.style({"stroke-width":1,stroke:this.layout.inner_border}),this.generateExtents();var e=function(t,e){var i=Math.pow(-10,e),a=Math.pow(-10,-e),n=Math.pow(10,-e),s=Math.pow(10,e);return t==1/0&&(t=s),t==-(1/0)&&(t=i),0==t&&(t=n),t>0&&(t=Math.max(Math.min(t,s),n)),t<0&&(t=Math.max(Math.min(t,a),i)),t},a={};if(this.x_extent){var n={start:0,end:this.layout.cliparea.width};this.layout.axes.x.range&&(n.start=this.layout.axes.x.range.start||n.start,n.end=this.layout.axes.x.range.end||n.end),a.x=[n.start,n.end],a.x_shifted=[n.start,n.end]}if(this.y1_extent){var s={start:this.layout.cliparea.height,end:0};this.layout.axes.y1.range&&(s.start=this.layout.axes.y1.range.start||s.start,s.end=this.layout.axes.y1.range.end||s.end),a.y1=[s.start,s.end],a.y1_shifted=[s.start,s.end]}if(this.y2_extent){var o={start:this.layout.cliparea.height,end:0};this.layout.axes.y2.range&&(o.start=this.layout.axes.y2.range.start||o.start,o.end=this.layout.axes.y2.range.end||o.end),a.y2=[o.start,o.end],a.y2_shifted=[o.start,o.end]}var r,l=null;if(this.interactions.zooming&&"function"==typeof this.x_scale){var h=Math.abs(this.x_extent[1]-this.x_extent[0]),d=Math.round(this.x_scale.invert(a.x_shifted[1]))-Math.round(this.x_scale.invert(a.x_shifted[0])),u=this.interactions.zooming.scale,p=Math.floor(d*(1/u));u<1&&!isNaN(this.parent.layout.max_region_scale)?u=1/(Math.min(p,this.parent.layout.max_region_scale)/d):u>1&&!isNaN(this.parent.layout.min_region_scale)&&(u=1/(Math.max(p,this.parent.layout.min_region_scale)/d));var c=Math.floor(h*u);r=this.interactions.zooming.center-this.layout.margin.left-this.layout.origin.x;var y=r/this.layout.cliparea.width,g=Math.max(Math.floor(this.x_scale.invert(a.x_shifted[0])-(c-d)*y),1);a.x_shifted=[this.x_scale(g),this.x_scale(g+c)]}else if(this.interactions.dragging)switch(this.interactions.dragging.method){case"background":a.x_shifted[0]=0+this.interactions.dragging.dragged_x,a.x_shifted[1]=this.layout.cliparea.width+this.interactions.dragging.dragged_x;break;case"x_tick":d3.event&&d3.event.shiftKey?(a.x_shifted[0]=0+this.interactions.dragging.dragged_x,a.x_shifted[1]=this.layout.cliparea.width+this.interactions.dragging.dragged_x):(r=this.interactions.dragging.start_x-this.layout.margin.left-this.layout.origin.x,l=e(r/(r+this.interactions.dragging.dragged_x),3),a.x_shifted[0]=0,a.x_shifted[1]=Math.max(this.layout.cliparea.width*(1/l),1));break;case"y1_tick":case"y2_tick":var f="y"+this.interactions.dragging.method[1]+"_shifted";d3.event&&d3.event.shiftKey?(a[f][0]=this.layout.cliparea.height+this.interactions.dragging.dragged_y,a[f][1]=0+this.interactions.dragging.dragged_y):(r=this.layout.cliparea.height-(this.interactions.dragging.start_y-this.layout.margin.top-this.layout.origin.y),l=e(r/(r-this.interactions.dragging.dragged_y),3),a[f][0]=this.layout.cliparea.height,a[f][1]=this.layout.cliparea.height-this.layout.cliparea.height*(1/l))}if(["x","y1","y2"].forEach(function(t){this[t+"_extent"]&&(this[t+"_scale"]=d3.scale.linear().domain(this[t+"_extent"]).range(a[t+"_shifted"]),this[t+"_extent"]=[Math.round(this[t+"_scale"].invert(a[t][0])),Math.round(this[t+"_scale"].invert(a[t][1]))],this[t+"_scale"]=d3.scale.linear().domain(this[t+"_extent"]).range(a[t]),this.layout.axes[t].ticks?this[t+"_ticks"]=this.layout.axes[t].ticks:this[t+"_ticks"]=i.prettyTicks(this[t+"_extent"],"both"),this.renderAxis(t))}.bind(this)),this.layout.interaction.scroll_to_zoom){var _=function(){if(d3.event.preventDefault(),!this.interactions.dragging&&!this.parent.loading_data){var t=d3.mouse(this.svg.container.node()),e=Math.max(-1,Math.min(1,d3.event.wheelDelta||-d3.event.detail));0!=e&&(this.interactions.zooming={scale:e<1?.9:1.1,center:t[0]},this.render(),null!=this.zoom_timeout&&clearTimeout(this.zoom_timeout),this.zoom_timeout=setTimeout(function(){this.interactions.zooming=!1,this.parent.applyState({start:this.x_extent[0],end:this.x_extent[1]})}.bind(this),500))}}.bind(this);this.zoom_listener=d3.behavior.zoom(),this.svg.container.call(this.zoom_listener).on("wheel.zoom",_).on("mousewheel.zoom",_).on("DOMMouseScroll.zoom",_)}return this.data_layer_ids_by_z_index.forEach(function(t){this.data_layers[t].draw().render()}.bind(this)),t?this:((this.layout.interaction.x_linked||this.layout.interaction.y1_linked||this.layout.interaction.y2_linked)&&["x","y1","y2"].forEach(function(t){this.layout.interaction[t+"_linked"]&&(this.interactions.zooming||this.interactions.dragging&&this.interactions.dragging["on_"+t])&&this.parent.panel_ids_by_y_index.forEach(function(e){e!=this.id&&this.parent.panels[e].layout.interaction[t+"_linked"]&&(this.parent.panels[e][t+"_scale"]=this[t+"_scale"],this.parent.panels[e].interactions=this.interactions,this.parent.panels[e].render(!0))}.bind(this))}.bind(this)),this)},i.Panel.prototype.renderAxis=function(t){if(["x","y1","y2"].indexOf(t)==-1)throw"Unable to render axis; invalid axis identifier: "+t;var e=this.layout.axes[t].render&&"function"==typeof this[t+"_scale"]&&!isNaN(this[t+"_scale"](0));if(this[t+"_axis"]&&this.svg.container.select("g.lz-axis.lz-"+t).style("display",e?null:"none"),!e)return this;var a={x:{position:"translate("+this.layout.margin.left+","+(this.layout.height-this.layout.margin.bottom)+")",orientation:"bottom",label_x:this.layout.cliparea.width/2,label_y:this.layout.axes[t].label_offset||0,label_rotate:null},y1:{position:"translate("+this.layout.margin.left+","+this.layout.margin.top+")",orientation:"left",label_x:-1*(this.layout.axes[t].label_offset||0),label_y:this.layout.cliparea.height/2,label_rotate:-90},y2:{position:"translate("+(this.layout.width-this.layout.margin.right)+","+this.layout.margin.top+")",orientation:"right",label_x:this.layout.axes[t].label_offset||0,label_y:this.layout.cliparea.height/2,label_rotate:-90}},n=function(t){for(var e=0;e<t.length;e++)if(isNaN(t[e]))return!1;return!0}(this[t+"_ticks"]);if(this[t+"_axis"]=d3.svg.axis().scale(this[t+"_scale"]).orient(a[t].orientation).tickPadding(3),n)this[t+"_axis"].tickValues(this[t+"_ticks"]),"region"==this.layout.axes[t].tick_format&&this[t+"_axis"].tickFormat(function(t){return i.positionIntToString(t,6)});else{var s=this[t+"_ticks"].map(function(t){return t.x});this[t+"_axis"].tickValues(s).tickFormat(function(e,i){return this[t+"_ticks"][i].text}.bind(this))}if(this.svg[t+"_axis"].attr("transform",a[t].position).call(this[t+"_axis"]),!n){var o=d3.selectAll("g#"+this.getBaseId().replace(".","\\.")+"\\."+t+"_axis g.tick"),r=this;o.each(function(e,i){var a=d3.select(this).select("text");r[t+"_ticks"][i].style&&a.style(r[t+"_ticks"][i].style),r[t+"_ticks"][i].transform&&a.attr("transform",r[t+"_ticks"][i].transform)})}var l=this.layout.axes[t].label||null;return this.layout.axes[t].label_function&&(l=i.LabelFunctions.get(this.layout.axes[t].label_function,this.state)),null!=l&&(this.svg[t+"_axis_label"].attr("x",a[t].label_x).attr("y",a[t].label_y).text(l),null!=a[t].label_rotate&&this.svg[t+"_axis_label"].attr("transform","rotate("+a[t].label_rotate+" "+a[t].label_x+","+a[t].label_y+")")),["x","y1","y2"].forEach(function(t){var e=this,i="."+this.parent.id+"."+this.id+".interaction.drag";if(this.layout.interaction["drag_"+t+"_ticks_to_scale"]){var a=function(){"function"==typeof d3.select(this).node().focus&&d3.select(this).node().focus();var e="x"==t?"ew-resize":"ns-resize";d3.event&&d3.event.shiftKey&&(e="move"),d3.select(this).style({"font-weight":"bold",cursor:e}).on("keydown"+i,a).on("keyup"+i,a)};this.svg.container.selectAll(".lz-axis.lz-"+t+" .tick text").attr("tabindex",0).on("mouseover"+i,a).on("mouseout"+i,function(){d3.select(this).style({"font-weight":"normal"}),d3.select(this).on("keydown"+i,null).on("keyup"+i,null)}).on("mousedown"+i,function(){e.toggleDragging(t+"_tick")})}}.bind(this)),this},i.Panel.prototype.toggleDragging=function(t){var e=function(t,e,i){this.data_layer_ids_by_z_index.forEach(function(a){this.data_layers[a].layout[t+"_axis"].axis==e&&(this.data_layers[a].layout[t+"_axis"].floor=i[0],this.data_layers[a].layout[t+"_axis"].ceiling=i[1],delete this.data_layers[a].layout[t+"_axis"].lower_buffer,delete this.data_layers[a].layout[t+"_axis"].upper_buffer,delete this.data_layers[a].layout[t+"_axis"].min_extent,delete this.data_layers[a].layout[t+"_axis"].ticks)}.bind(this))}.bind(this);if(t=t||null,this.interactions.dragging){switch(this.interactions.dragging.method){case"background":case"x_tick":0!=this.interactions.dragging.dragged_x&&(e("x",1,this.x_extent),this.parent.applyState({start:this.x_extent[0],end:this.x_extent[1]}));break;case"y1_tick":case"y2_tick":if(0!=this.interactions.dragging.dragged_y){var i=this.interactions.dragging.method[1];e("y",i,this["y"+i+"_extent"])}}return this.interactions.dragging=!1,this.svg.container.style("cursor",null),this}if(this.canInteract()){var a=d3.mouse(this.svg.container.node());return this.interactions.dragging={method:t,panel_id:this.id,start_x:a[0],start_y:a[1],dragged_x:0,dragged_y:0},"background"!=t&&"x_tick"!=t||(this.interactions.dragging.on_x=!0),"y1_tick"==t&&(this.interactions.dragging.on_y1=!0),"y2_tick"==t&&(this.interactions.dragging.on_y2=!0),this.svg.container.style("cursor","all-scroll"),this}return this},i.Panel.prototype.scaleHeightToData=function(t){var t=+t||null;null==t&&this.data_layer_ids_by_z_index.forEach(function(e){var i=this.data_layers[e].getAbsoluteDataHeight();+i&&(t=null==t?+i:Math.max(t,+i))}.bind(this)),+t&&(t+=+this.layout.margin.top+ +this.layout.margin.bottom,this.setDimensions(this.layout.width,t),this.parent.setDimensions(),this.parent.panel_ids_by_y_index.forEach(function(t){this.parent.panels[t].layout.proportional_height=null}.bind(this)),this.parent.positionPanels())},i.Panel.prototype.setElementStatusByFilters=function(t,e,i,a){this.data_layer_ids_by_z_index.forEach(function(n){this.data_layers[n].setElementStatusByFilters(t,e,i,a)}.bind(this))},i.Panel.prototype.setAllElementStatus=function(t,e){this.data_layer_ids_by_z_index.forEach(function(i){this.data_layers[i].setAllElementStatus(t,e)}.bind(this))},i.DataLayer.Statuses.verbs.forEach(function(t,e){var a=i.DataLayer.Statuses.adjectives[e],n="un"+t;i.Panel.prototype[t+"ElementsByFilters"]=function(t,e){return e="undefined"!=typeof e&&!!e,this.setElementStatusByFilters(a,!0,t,e)},i.Panel.prototype[n+"ElementsByFilters"]=function(t,e){return e="undefined"!=typeof e&&!!e,this.setElementStatusByFilters(a,!1,t,e)},i.Panel.prototype[t+"AllElements"]=function(){return this.setAllElementStatus(a,!0),this},i.Panel.prototype[n+"AllElements"]=function(){return this.setAllElementStatus(a,!1),this}}),i.Panel.prototype.addBasicLoader=function(t){return"undefined"!=typeof t&&(t=!0),t&&this.loader.show("Loading...").animate(),this.on("data_requested",function(){this.loader.show("Loading...").animate()}.bind(this)),this.on("data_rendered",function(){this.loader.hide()}.bind(this)),this},"function"==typeof define&&define.amd?(this.LocusZoom=i,define(i)):"object"==typeof module&&module.exports?module.exports=i:this.LocusZoom=i}catch(a){console.log("LocusZoom Plugin error: "+a)}}();